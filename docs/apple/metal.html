<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metal">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Metal | yianzhou</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://yianzhou.github.io/docs/apple/metal"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Metal | yianzhou"><meta data-rh="true" name="description" content="Metal 官方文档翻译"><meta data-rh="true" property="og:description" content="Metal 官方文档翻译"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yianzhou.github.io/docs/apple/metal"><link data-rh="true" rel="alternate" href="https://yianzhou.github.io/docs/apple/metal" hreflang="en"><link data-rh="true" rel="alternate" href="https://yianzhou.github.io/docs/apple/metal" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6a91212d.css">
<link rel="preload" href="/assets/js/runtime~main.0388ab28.js" as="script">
<link rel="preload" href="/assets/js/main.e115001f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="yianzhou" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="yianzhou" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">yianzhou</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/apple">Apple</a><a class="navbar__item navbar__link" href="/docs/dev">开发</a><a class="navbar__item navbar__link" href="/docs/language">编程语言</a><a class="navbar__item navbar__link" href="/docs/flutter">Flutter</a><a class="navbar__item navbar__link" href="/docs/insights">Insights</a><a class="navbar__item navbar__link" href="/docs/codes">Codes</a><a class="navbar__item navbar__link" href="/docs/ai">AI</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yianzhou/yianzhou.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/SDWebImage">SDWebImage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/UIKit">UIKit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/afnetworking">AFNetworking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/app-extension">App Extension</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/app-in-the-background">App in the Background</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/app-size">包大小</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/app-startup">App Startup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/apple-bugs">Apple Bugs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/aspects">Aspects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/cicd">CICD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/cocoapods">Cocoapods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/core-animation">Core Animation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/crash">崩溃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple">Debug</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/frameworks">Frameworks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/graphics">图形渲染</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/http">HTTP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/instruments">Instruments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/lag">卡顿</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/llvm">LLVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/mach-o">Mach-O</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/matrix">Matrix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/memory">内存</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/apple/metal">Metal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/multithread">多线程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/networking">Apple Networking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/performance">性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/semaphore">信号量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/symbolic">符号化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/uiscene">UIScene</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/unified-logging">Unified Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/uniform-type-identifiers">Uniform Type Identifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/user-notification">User Notification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/webkit">WebKit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/wwdc">WWDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/wwdc23">WWDC23</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/xcassets">XCAssets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/xcode">Xcode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/xctest">XCTest</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/音视频/audio-video">音视频</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/项目配置">项目配置</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Metal</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Metal</h1><p><a href="https://www.jianshu.com/p/0ab0a3823819" target="_blank" rel="noopener noreferrer">Metal 官方文档翻译</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metal-and-metalkit">Metal and MetalKit<a href="#metal-and-metalkit" class="hash-link" aria-label="Direct link to Metal and MetalKit" title="Direct link to Metal and MetalKit">​</a></h2><p>Metal：提供 GPU 的直接控制。</p><p>MetalKit：提供 <code>MTKView: UIView</code>，a MetalKit view automatically sets up and manages a continuous rendering loop that provides you with a 2D, displayable resource, commonly known as a <strong>drawable</strong>, for each frame.</p><p>When developing a Metal app, it’s often useful to separate your rendering loop into its own class.</p><p>A <code>MTKViewDelegate</code> object implements <code>drawInMTKView:</code> methods. The view calls the <code>drawInMTKView:</code> method whenever it’s time to render a new frame, as specified by the frame rate (for example, 60 FPS) set on the view’s <code>preferredFramesPerSecond</code> property. This callback is typically the main event that begins the execution of your rendering loop.</p><p>This rate is not guaranteed: the view will pick a closest frame rate that the display is capable of refreshing (usually 30 or 60 times per second). Also if our renderer spends more than 1/60th of a second in <code>-[AAPLRender drawInMTKView:]</code> the view will skip further calls until the renderer has returned from that long <code>-[AAPLRender drawInMTKView:]</code> call. In other words, the view will drop frames. So we should set this to a frame rate that we think our renderer can consistently maintain.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metal-objects">Metal Objects<a href="#metal-objects" class="hash-link" aria-label="Direct link to Metal Objects" title="Direct link to Metal Objects">​</a></h2><p><a href="https://developer.apple.com/documentation/metal/using_a_render_pipeline_to_render_primitives" target="_blank" rel="noopener noreferrer">Using a Render Pipeline to Render Primitives</a></p><p>In this Devices and Commands sample, you learned how to write an app that uses Metal and issues basic rendering commands to the GPU.</p><p>A <code>MTLDevice</code> object represents a GPU.</p><p>The first object all apps need to interact with the GPU is a <code>MTLCommandQueue</code> object.</p><p>You use a <code>MTLCommandQueue</code> object to create and organize <code>MTLCommandBuffer</code> objects, ensuring that they’re sent to the GPU in the correct order. For every frame, a new <code>MTLCommandBuffer</code> object is created and filled with commands that are executed by the GPU.</p><p>A <code>MTLCommandBuffer</code> object coalesces different commands into a single submission, but they must first be encoded in a device-agnostic 与设备无关的 way using a <code>MTLCommandEncoder</code> object.</p><p>To create a <code>MTLRenderCommandEncoder</code> object, you must first create a <code>MTLRenderPassDescriptor</code> object. A MetalKit view creates a new <code>MTLRenderPassDescriptor</code> object for every frame, provided via the <code>currentRenderPassDescriptor</code> property.</p><p>Commands encoded into this <code>MTLRenderCommandEncoder</code> object render to the view’s drawable. By default, creating a <code>MTLRenderCommandEncoder</code> object implicitly encodes a clear command that the GPU executes before any other rendering commands.</p><p>You call the <code>presentDrawable:</code> method to tell Metal to wait for the GPU to finish rendering to a drawable before presenting it onscreen.</p><p>The GPU also doesn’t execute commands until <code>[commandBuffer commit];</code>. When the GPU begins execution, the drawable is cleared with a new color. When the GPU completes execution, the rendered drawable is presented onscreen.</p><p><img loading="lazy" src="https://docs-assets.developer.apple.com/published/6aedb538f8/b5ff0489-1079-441a-8a24-8f8c75dd2b1e.png" alt="image" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rendering-pipeline">Rendering Pipeline<a href="#rendering-pipeline" class="hash-link" aria-label="Direct link to Rendering Pipeline" title="Direct link to Rendering Pipeline">​</a></h2><p>In its most basic form, the pipeline receives vertices as input and renders pixels as output. This sample focuses on the three main stages of the pipeline: The vertex function and fragment function are programmable stages. The rasterization stage is fixed.</p><p><img loading="lazy" src="https://docs-assets.developer.apple.com/published/a8fcc3ae6f/24096b5e-34f4-460d-a72b-ca5fb5ef51e5.png" alt="image" class="img_ev3q"></p><p><strong>Vertex</strong> data is usually loaded from a file that contains 3D model data exported from specialized modeling software.</p><p>Vertex data, and 3D graphics data in general, is usually defined with <strong>vector</strong> data types, simplifying common graphics algorithms and GPU processing. This sample uses optimized vector data types provided by the <a href="http://ermig1979.github.io/Simd/" target="_blank" rel="noopener noreferrer">SIMD library</a> to represent the triangle’s vertices.</p><p>Using SIMD data types in your Metal app ensures that memory layouts match exactly across CPU/GPU declarations and facilitates sending vertex data from the CPU to the GPU.</p><p>A <a href="https://developer.apple.com/documentation/metal/mtlviewport" target="_blank" rel="noopener noreferrer">viewport</a> is a <strong>3D area</strong> with an x and y offset, a width and height, and near and far planes (for 3D contents).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-function">Vertex function<a href="#vertex-function" class="hash-link" aria-label="Direct link to Vertex function" title="Direct link to Vertex function">​</a></h3><p>The main task of a <strong>vertex function</strong> (also known as a vertex shader) is to process incoming vertex data and map each vertex to a position in the viewport. This way, subsequent stages in the pipeline can refer to this viewport position and render pixels to an exact location in the drawable. The vertex function accomplishes this task by translating arbitrary vertex coordinates into normalized device coordinates (NDC), also known as <strong>clip-space coordinates</strong>.</p><p><strong>Clip space is a 2D coordinate system</strong> that maps the viewport area to a <!-- -->[-1.0, 1.0]<!-- --> range along both the x and y axes.</p><p>Vertex functions are written in the Metal shading language(<code>.metal</code>), which is based on C++ 14. Traditional C/C++ code is typically executed on the CPU, whereas Metal shading language code is exclusively executed on the GPU.</p><p>关于函数中的<code>[[]]</code>属性修饰符困扰了我一段时间，这是苹果定义好的描述属性的修饰符。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rasterization">Rasterization<a href="#rasterization" class="hash-link" aria-label="Direct link to Rasterization" title="Direct link to Rasterization">​</a></h3><p>我们设置了三角形三个顶点的颜色，那么位于三角形区域内的其它顶点的颜色如何确定呢？The rasterizer passes color values to the fragment function after converting them from per-vertex values to per-fragment values. This conversion uses a fixed interpolation function, which calculates a single weighted color derived from the color values of the triangle’s three vertices. The weights for the interpolation function (also known as barycentric coordinates) are the relative distances of each vertex position to the center of a fragment.</p><p>这是一个不可编程的步骤。Because rasterization is a fixed pipeline stage, its behavior can’t be modified by custom Metal shading language code.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fragment-function">Fragment Function<a href="#fragment-function" class="hash-link" aria-label="Direct link to Fragment Function" title="Direct link to Fragment Function">​</a></h3><p>The main task of a fragment function (also known as fragment shader) is to process incoming fragment data and calculate a RGBA color value for the drawable’s pixels.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-function-libraries-and-create-a-pipeline">Obtain Function Libraries and Create a Pipeline<a href="#obtain-function-libraries-and-create-a-pipeline" class="hash-link" aria-label="Direct link to Obtain Function Libraries and Create a Pipeline" title="Direct link to Obtain Function Libraries and Create a Pipeline">​</a></h2><p>Metal shading language code is compiled in two stages:</p><ol><li>Front-end compilation happens in Xcode at build time. <code>.metal</code> files are compiled from high-level source code into intermediate representation (IR) files.</li><li>Back-end compilation happens in a physical device at runtime. IR files are then compiled into low-level machine code.</li></ol><p>These <code>MTLFunction</code> objects are used to create a <code>MTLRenderPipelineState</code> object that <strong>represents the graphics-rendering pipeline</strong>. Calling the <code>newRenderPipelineStateWithDescriptor:error:</code> method of a <code>MTLDevice</code> object begins the back-end compilation process that links the <code>vertexShader</code> and <code>fragmentShader</code> functions, resulting in a fully compiled pipeline.</p><p>A view’s <strong>pixel format</strong> defines the memory layout of each of its pixels. This sample only renders to a single target, the view’s drawable (<code>colorAttachments[0]</code>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="draw-a-triangle">Draw a triangle<a href="#draw-a-triangle" class="hash-link" aria-label="Direct link to Draw a triangle" title="Direct link to Draw a triangle">​</a></h2><p>Triangles are geometric primitives in Metal that require three vertices to be drawn. With the drawing complete, the render loop can end encoding, commit the command buffer, and present the drawable containing the rendered triangle.</p><blockquote><p><a href="https://developer.apple.com/documentation/metal/basic_buffers" target="_blank" rel="noopener noreferrer">Basic Buffers: Demonstrates how to manage hundreds of vertices with a vertex buffer.</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vertex-buffer">Vertex Buffer<a href="#vertex-buffer" class="hash-link" aria-label="Direct link to Vertex Buffer" title="Direct link to Vertex Buffer">​</a></h2><p>Typically, Metal apps or games draw models with thousands of vertices, each with multiple vertex attributes, that consume several megabytes of memory. For these apps or games to scale well and be managed efficiently, Metal provides specialized data containers represented by <code>MTLBuffer</code> objects. This sample allocates a large amount of vertex data once, copies it into a <code>MTLBuffer</code> object, and then reuses the vertex data in each frame.</p><p>这个案例省略了从模型中加载顶点信息的过程，而用一个我们定义的方法来生成，包装在<code>NSData</code>里。In Objective-C, byte buffers are wrapped by <code>NSData</code> objects. The complexity of model-loading code varies by model, but ultimately the vertex data is also stored in a byte buffer that’s handed off to Metal code.</p><blockquote><p><a href="https://developer.apple.com/documentation/metal/basic_texturing" target="_blank" rel="noopener noreferrer">Basic Texturing: Demonstrates how to load image data and texture a quad.</a></p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="texture">Texture<a href="#texture" class="hash-link" aria-label="Direct link to Texture" title="Direct link to Texture">​</a></h2><p>In this sample, image data is loaded into a texture, applied to a single quad, and rendered as a 2D image. To populate a Metal texture with image data, its pixel data must already be formatted in a Metal-compatible pixel format, defined by a single <code>MTLPixelFormat</code> enumeration value.</p><p>The pixel format describes the layout of each of the texture’s pixels (its <strong>texels</strong>).</p><p>In this sample, for simplicity, the custom <code>AAPLImage</code> class loads image data from a file (Image.tga) into memory (NSData).</p><p><code>MTLPixelFormatBGRA8Unorm</code> indicates that each pixel has a blue, green, red, and alpha channel, where each channel is an 8-bit unsigned normalized value (i.e. 0 maps to 0.0 and 255 maps to 1.0).</p><p><code>MTLTexture</code> objects are used specifically to store formatted image data.</p><p>Textures have known dimensions that can be interpreted as regions of pixels. A <code>MTLRegion</code> structure is used to identify a specific <em>region</em> of a texture.</p><p>A texture can’t be rendered on its own; it must correspond to some geometric surface that’s output by the vertex function and turned into fragments by the rasterizer. This relationship is defined by <strong>texture coordinates</strong>: floating-point positions that map locations on a texture image to locations on a geometric surface.</p><p>Reading a texel is also known as sampling. The fragment function uses the built-in texture <code>sample()</code> function to sample texel data.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yianzhou/yianzhou.github.io/docs/apple/metal.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/apple/memory"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">内存</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/apple/multithread"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">多线程</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#metal-and-metalkit" class="table-of-contents__link toc-highlight">Metal and MetalKit</a></li><li><a href="#metal-objects" class="table-of-contents__link toc-highlight">Metal Objects</a></li><li><a href="#rendering-pipeline" class="table-of-contents__link toc-highlight">Rendering Pipeline</a><ul><li><a href="#vertex-function" class="table-of-contents__link toc-highlight">Vertex function</a></li><li><a href="#rasterization" class="table-of-contents__link toc-highlight">Rasterization</a></li><li><a href="#fragment-function" class="table-of-contents__link toc-highlight">Fragment Function</a></li></ul></li><li><a href="#obtain-function-libraries-and-create-a-pipeline" class="table-of-contents__link toc-highlight">Obtain Function Libraries and Create a Pipeline</a></li><li><a href="#draw-a-triangle" class="table-of-contents__link toc-highlight">Draw a triangle</a></li><li><a href="#vertex-buffer" class="table-of-contents__link toc-highlight">Vertex Buffer</a></li><li><a href="#texture" class="table-of-contents__link toc-highlight">Texture</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">粤ICP备15029205号 Copyright © 2024 yianzhou</div></div></div></footer></div>
<script src="/assets/js/runtime~main.0388ab28.js"></script>
<script src="/assets/js/main.e115001f.js"></script>
</body>
</html>