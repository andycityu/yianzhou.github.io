<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-底层原理/performance">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">性能优化 | yianzhou</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://yianzhou.github.io/docs/apple/底层原理/performance"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="性能优化 | yianzhou"><meta data-rh="true" name="description" content="Measuring"><meta data-rh="true" property="og:description" content="Measuring"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://yianzhou.github.io/docs/apple/底层原理/performance"><link data-rh="true" rel="alternate" href="https://yianzhou.github.io/docs/apple/底层原理/performance" hreflang="en"><link data-rh="true" rel="alternate" href="https://yianzhou.github.io/docs/apple/底层原理/performance" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6a91212d.css">
<link rel="preload" href="/assets/js/runtime~main.1044df96.js" as="script">
<link rel="preload" href="/assets/js/main.76ae18e3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="yianzhou" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="yianzhou" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">yianzhou</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/apple">Apple</a><a class="navbar__item navbar__link" href="/docs/dev">开发</a><a class="navbar__item navbar__link" href="/docs/language">编程语言</a><a class="navbar__item navbar__link" href="/docs/flutter">Flutter</a><a class="navbar__item navbar__link" href="/docs/insights">Insights</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yianzhou/yianzhou.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/Frameworks/SDWebImage">Frameworks</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/apple-bugs">Apple Bugs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple">Debug</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/uniform-type-identifiers">Uniform Type Identifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/wwdc">WWDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/apple/xcode">Xcode</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/代码/file">代码</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/工具/app-size">工具</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/工程/frameworks">工程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/apple/底层原理/app-launch">底层原理</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/app-launch">启动时长优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/crash">崩溃</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/lag">卡顿</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/llvm">LLVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/memory">内存优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/multithread">多线程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/apple/底层原理/performance">性能优化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/apple/底层原理/semaphore">信号量</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/网络/afnetworking">网络</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/apple/音视频、图形/audio-video">音视频、图形</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">底层原理</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">性能优化</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>性能优化</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="measuring">Measuring<a href="#measuring" class="hash-link" aria-label="Direct link to Measuring" title="Direct link to Measuring">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2015/230/" target="_blank" rel="noopener noreferrer">WWDC 2015 - Performance on iOS and watchOS</a></p></blockquote><p>Code Instrumentation: (Profiling in release builds but don&#x27;t ship your instrumentation)</p><div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token attribute atrule" style="color:#00a4db">@IBAction</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">showImageTapped</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sender</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">UIButton</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token directive property directive-name" style="color:#36acaa">#if</span><span class="token directive property" style="color:#36acaa"> MEASURE_PERFORMANCE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CFAbsoluteTimeGetCurrent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token directive property directive-name" style="color:#36acaa">#endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">contentOfFile</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> myImage </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">watermarkedImageFromData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">myData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">imageView</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> myImage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token directive property directive-name" style="color:#36acaa">#if</span><span class="token directive property" style="color:#36acaa"> MEASURE_PERFORMANCE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> endTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">CFAbsoluteTimeGetCurrent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> totalTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">endTime </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> startTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">&quot;showImageTappedTimed took </span><span class="token punctuation" style="color:#393A34">\</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">totalTime</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> milliseconds”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token directive property directive-name" style="color:#36acaa">#endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2018/407/" target="_blank" rel="noopener noreferrer">WWDC 2018 - Practical Approaches to Great App Performance</a></p></blockquote><p>性能优化的方法论：</p><p>All performance work should be based on measurement.</p><p>Before you start solving a performance problem, you should measure, to establish a baseline so you know where you stand.</p><p>As you iterate on solving a performance problem, you should measure it each step of the way to ensure that your performance changes are having the impact that you expect.</p><p>When you&#x27;re done solving a performance problem, you should measure again, so that you can compare to your original baseline, and make a quantified claim about how much you&#x27;ve improved the performance of your application.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="time-profiler">Time Profiler<a href="#time-profiler" class="hash-link" aria-label="Direct link to Time Profiler" title="Direct link to Time Profiler">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2015/412/" target="_blank" rel="noopener noreferrer">WWDC 2015 - Profiling in Depth</a></p><p><a href="https://developer.apple.com/videos/play/wwdc2016/418/" target="_blank" rel="noopener noreferrer">WWDC 2016 - Using Time Profiler in Instruments</a></p><p><a href="https://developer.apple.com/videos/play/wwdc2018/407" target="_blank" rel="noopener noreferrer">WWDC 2018 - Practical Approaches to Great App Performance</a></p></blockquote><p>I would encourage all of you, if you just learn one of Instruments, it should be the <strong>Time Profiler</strong>. I use it for 95% or more of my performance work.</p><p>You should do your time profiling on <strong>release builds</strong> to take advantage of the compiler optimizations. 其中一项编译器优化就是尾调用消除，后面会详细介绍。</p><p>使用技巧：</p><ul><li>按住 option 键可展开至最深层调用栈</li><li>右侧 Heaviest Stack Trace</li><li>按 CPU 查看、按线程查看，可以检查我们的代码是否真正利用了多线程并发</li><li>Self Weight: the amount of time that was spent within that method itself, and not some other method that it called</li></ul><p>我跑 Time Profiler 怎么看不到函数符号呀？——定位一下 dSYM 文件路径</p><p><img loading="lazy" alt="img" src="/assets/images/C3C0DE1C-CA31-4F83-B956-B4C3AA80E622-f22a384a91ebe7ed60973c501b339306.png" width="1452" height="944" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it works" title="Direct link to How it works">​</a></h3><p><img loading="lazy" alt="img" src="/assets/images/167519af-1739-429e-bbf7-5535d7445fb6-7b3619c84c2aef804e558ade95cc8fd0.png" width="2560" height="763" class="img_ev3q"></p><p>When the call is made to the <code>drawRect:</code> it will push a <strong>call frame</strong> onto the stack including return address from the link register and the previous value of the <strong>frame pointer</strong>. Now <code>drawRect:</code> knows how to return to its caller and restore the frame pointer.</p><p>Next, we take the frame pointer set up to the new base. Then <code>drawRect:</code> will make room for its local variables and the compiler scratch space 暂存空间. Now we have a frame for <code>drawRect:</code>.</p><p>Next the code starts to run and we come down to <code>CGContextDrawPath</code> and it does the same thing. It pushes a frame onto the stack.</p><p><img loading="lazy" alt="img" src="/assets/images/76af6702-aa11-4e25-91cd-4e8978da25bc-b1ad7587f021dd9a2c92f90941f3f662.png" width="2560" height="1424" class="img_ev3q"></p><p>The way time profiler works, it uses a service in the kernel that will sample what the CPUs are doing at about 1000 times per second.</p><p>In this case, if we take a sample, we see that we&#x27;re running inside of <code>CGContextDrawPath</code>.</p><p>Then the kernal looks at the frame pointer register to see where the base of that function&#x27;s frame is and find the return address of who called it.</p><p>We can use the frame pointers that were pushed on the stack to find the base of <code>drawRect:</code> and then continuously go back through the stack until we hit the bottom. This is called <strong>backtrace</strong>.</p><p>If we take enough of these and put them in the call tree view you can get a pretty good picture of what&#x27;s going on inside of your application.</p><p><img loading="lazy" alt="img" src="/assets/images/b0a15964-67cd-4478-8c23-9645a58ac3bc-787a3998f44f1cc4749c98e0d3e27798.png" width="2560" height="1455" class="img_ev3q"></p><p>Time Profiler&#x27;s not actually measuring duration. It&#x27;s not recording when the method starts, and then when it exits. It&#x27;s <strong>aggregating the samples</strong> into a useful summary. So when you see time values in Time Profiler, that&#x27;s the number of samples multiplied by the time between samples, which is 1 millisecond in most cases.（样本数量乘以样本时间间隔）</p><p>This does have some side effects. First, it doesn&#x27;t distinguish between long running methods, and much faster methods that are called repetitively. Second, it doesn&#x27;t necessarily capture everything. If you have really fast functions that aren&#x27;t called very often, they won&#x27;t appear in your call tree. But this is actually okay because they&#x27;re not having an impact in how much work I have to be doing over time.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tail-call-elimination">Tail Call Elimination<a href="#tail-call-elimination" class="hash-link" aria-label="Direct link to Tail Call Elimination" title="Direct link to Tail Call Elimination">​</a></h3><p>You notice when <code>CGContextDrawPath</code> returns, <code>drawRect:</code> returns. The way it returns is it pops the stack frame, restores the previous value of the frame pointer and jumps back to the caller. The compiler makes optimization here. It&#x27;s going to pop the <code>drawRect:</code> stack frame, restore the frame pointer and make a direct call back into <code>CGContextDrawPath</code>. From <code>CGContextDrawPath</code>&#x27;s perspective it was called directly from <code>drawLayer:inContext:</code> from UIKit.</p><p>This is called Tail Call Elimination who has some benefits. It saves stack memory. In the process of saving stack memory, it keeps the caches hot, that reuses the memory, the caches and data. It has a profound effect on recursive code, especially tail call recursive code, where a function or method calls itself as the last thing and then returns.</p><p>If you want to turn it off to show a cleaner stack trace you can turn it off by going in the build settings of the project and setting the compiler flag, the <code>CFLAGS=-fno-optimize-sibling-calls</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="objc_msgsend">objc_msgSend<a href="#objc_msgsend" class="hash-link" aria-label="Direct link to objc_msgSend" title="Direct link to objc_msgSend">​</a></h3><p><code>objc_msgSend</code> implicitly gets inserted by the compiler whenever you use the square bracket notation or whenever you use the dot notation to access a property on an object. Its purpose is to look up the method implementation for the selector and invoke that method. That&#x27;s how we do dynamic dispatch in Objective-C. <code>objc_msgSend</code> is extremely fast and does not push a stack frame.</p><p>通过<strong>实测</strong>发现，objc 的消息发送消耗了一定的 CPU 时间，我们希望优化这部分时间。<strong>Method caching</strong> was not as fast as <strong>inlining</strong>. What we really want in this case is that small method body to be inlined. You have alternatives: use C or C++. However, Swift is more ideal, because unlike Objective-C it is only dynamic when it needs to be. If you make sure that the performance critical classes are internal and you use <strong>whole module optimization</strong>, the compiler or the whole tool chain can determine when there&#x27;s only one method implementation and inlines it right into the call site giving you some significant wins especially on the iterator case.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="火焰图">火焰图<a href="#火焰图" class="hash-link" aria-label="Direct link to 火焰图" title="Direct link to 火焰图">​</a></h2><p>火焰图是基于函数调用堆栈信息生成的 SVG 图片。</p><p><img loading="lazy" alt="img" src="/assets/images/C9CC6F74-F110-47C4-AF36-5C334EA89B91-752037d0cd91caf249f3ec9af3c902a8.png" width="732" height="678" class="img_ev3q"></p><p>x 轴表示抽样数，如果一个函数在 x 轴占据的宽度越宽，就表示它被抽到的次数多，即执行的时间长。注意，x 轴不代表时间，而是所有的调用栈合并后，按字母顺序排列的。</p><p>颜色没有特殊含义，因为火焰图表示的是 CPU 的工作，所以一般选择暖色调。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="responsiveness">Responsiveness<a href="#responsiveness" class="hash-link" aria-label="Direct link to Responsiveness" title="Direct link to Responsiveness">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2016/418/" target="_blank" rel="noopener noreferrer">WWDC 2016 - Using Time Profiler in Instruments</a></p></blockquote><p>The way your application works, is the main thread that does all the user interface work. It&#x27;s responsible for responding to user input, and then updating your views. The main thread has a runloop that&#x27;s just watching a queue called an Event Queue and waiting for events to appear on it. When an event appears, it sends it to your <code>UIApplication</code> instance, which then passes the event down through the responder chain in your application.</p><p>When busy, the main thread can&#x27;t process the queue. And then as a result, you get stuttering and hiccups. So it&#x27;s really important to keep your main thread free, so it&#x27;s able to respond to the user input in a very quick manner.</p><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2016/719/" target="_blank" rel="noopener noreferrer">WWDC 2016 - Optimizing I/O for Performance and Battery Life</a></p></blockquote><p>Every thread or every application on the system starts with a single thread called the main thread. This thread is special, and it has a few primary purposes. That is to handle input and to update your interface (drawing views, doing layout, or animating). If you&#x27;re doing other things on your main thread, such as executing lengthy tasks like expensive image processing, that will keeps your main thread busy, which means it won&#x27;t be idle, you won&#x27;t be able to respond to input, or update your UI. Additionally, you should avoid doing I/O on your main thread.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="io">I/O<a href="#io" class="hash-link" aria-label="Direct link to I/O" title="Direct link to I/O">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2016/719/" target="_blank" rel="noopener noreferrer">WWDC 2016 - Optimizing I/O for Performance and Battery Life</a></p></blockquote><p>The main system resources are CPU, memory, and I/O. Operations that interact with the file system and deal with reading or writing files are generally considered an I/O. Talking to a web server is a good example of network-based I/O. When your app is using I/O, it runs code on the CPU, accesses memory, and ultimately saves data to or fetches data from the disk. If the network is involved, the network-based radios are interacted with as well. The combined power cost of all of these competents makes I/O a heavy operation in terms of battery usage.</p><p>Best practices:</p><ul><li>Caching: Do caching but make balance between memory usage and disk I/O. Just like I/O, memory is a shared and limited resource in the system that you should be careful. We recommend using the <code>NSCache</code> APIs since they handle memory pressure conditions appropriately.</li><li>Coalescing I/Os: Collects a bunch of updates that were frequently done, and write them out as a single I/O operation.</li></ul><p>To debug:</p><ul><li>Xcode - Run - Debug Navigator - Disk</li><li>Instruments - Template: Blank - Add Library: Disk Usage</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="xctest-metrics">XCTest Metrics<a href="#xctest-metrics" class="hash-link" aria-label="Direct link to XCTest Metrics" title="Direct link to XCTest Metrics">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2019/417/" target="_blank" rel="noopener noreferrer">WWDC 2019 - Improving Battery Life and Performance</a></p></blockquote><p>CPU, memory, storage, clock and OSSignpost.</p><div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// This test measures time, memory, and CPU impact</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">testPhotoUploadPerformance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">XCUIApplication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">measure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">XCTClockMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token class-name">XCTMemoryMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      </span><span class="token class-name">XCTCPUMetric</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">buttons</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;Apply Effect&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dialogs</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;alert&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">buttons</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string-literal string" style="color:#e3116c">&quot;OK&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">tap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Because XCTest works so well with both Xcode and Xcode server, you could use this performance test both in your development and testing phase and also as part of your <strong>continuous integration</strong> system and ensure that your app doesn&#x27;t regress on the performance.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrickit">MetricKit<a href="#metrickit" class="hash-link" aria-label="Direct link to MetricKit" title="Direct link to MetricKit">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2019/417/" target="_blank" rel="noopener noreferrer">WWDC 2019 - Improving Battery Life and Performance</a></p><p><a href="https://developer.apple.com/videos/play/wwdc2020/10081/" target="_blank" rel="noopener noreferrer">WWDC 2020 - What&#x27;s new in MetricKit</a></p></blockquote><p>With MetricKit, you can receive on-device app diagnostics and power and performance metrics captured by the system. A registered app receives reports containing data about the previous 24 hours at most once per day. Over the course of the day, the operating system is passively aggregating performance data for your app as it is used. This data is anonymized and designed to protect user privacy.</p><p>It&#x27;s up to you to take any actions once you receive this payload on the device. For example, you can choose to save it to a file, or you can also upload to your server so you can collect this from the field for multiple users.</p><div class="language-swift codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-swift codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token class-name">MetricKit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MySubscriber</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">NSObject</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">MXMetricManagerSubscriber</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> metricManager</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token class-name">MXMetricManager</span><span class="token operator" style="color:#393A34">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">override</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">super</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metricManager </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">MXMetricManager</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">shared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metricManager</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">override</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">deinit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metricManager</span><span class="token operator" style="color:#393A34">?</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">didReceive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token omit keyword" style="color:#00009f">_</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MXMetricPayload</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// new in iOS 13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function-definition function" style="color:#d73a49">didReceive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token omit keyword" style="color:#00009f">_</span><span class="token plain"> payload</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token class-name">MXDiagnosticPayload</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// new in iOS 14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="app-store-connect-api">App Store Connect API<a href="#app-store-connect-api" class="hash-link" aria-label="Direct link to App Store Connect API" title="Direct link to App Store Connect API">​</a></h2><blockquote><p><a href="https://developer.apple.com/videos/play/wwdc2020/10057/" target="_blank" rel="noopener noreferrer">WWDC 2020 - Identify trends with the Power and Performance API</a></p></blockquote><p>We introduced our new <strong>App Store Connect API</strong> for power and performance. With this new API, you can programmatically access the same metrics and diagnostics data as Xcode Organizer, and build customized data analytics and monitoring systems around power and performance metrics. We also introduced <strong>smart insights</strong> that can help you identify key trends and regression in metrics.</p><p>API resources:</p><ul><li>metrics and insights for recent app versions: <code>GET /v1/apps/{id}/perfPowerMetrics</code></li><li>metrics for specific app version</li><li>diagnostic signatures for specific app version: <code>GET /v1/builds/{id}/diagnosticSignatures</code></li><li>diagnostic logs per signature: <code>GET /v1/diagnosticSignatures/{id}/logs</code></li></ul><p>There are two parts to power and performance diagnostics.</p><p>First, we use <strong>diagnostic signatures</strong> to group similar problems together. For instance, similar disk writes exceptions are aggregated to generate disk writes signatures. Using diagnostic signatures, we can do root cause analysis by problem group. The API returns most prevalent top signatures for your app version, and given a top signature and its ID, you can get related diagnostic logs with more details.</p><p>The second part is <strong>diagnostic log</strong>. It contains anonymized diagnostic details from individual devices.
And this includes metadata information, such as platform, OS version and device type. And also, the log contains function call stack trees, which can be extremely helpful to understand what is causing the power and performance hotspots. The diagnostic call stack JSON structure is also <strong>shared with MetricKit</strong>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yianzhou/yianzhou.github.io/docs/apple/底层原理/performance.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/apple/底层原理/multithread"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">多线程</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/apple/底层原理/semaphore"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">信号量</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#measuring" class="table-of-contents__link toc-highlight">Measuring</a></li><li><a href="#time-profiler" class="table-of-contents__link toc-highlight">Time Profiler</a><ul><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it works</a></li><li><a href="#tail-call-elimination" class="table-of-contents__link toc-highlight">Tail Call Elimination</a></li><li><a href="#objc_msgsend" class="table-of-contents__link toc-highlight">objc_msgSend</a></li></ul></li><li><a href="#火焰图" class="table-of-contents__link toc-highlight">火焰图</a></li><li><a href="#responsiveness" class="table-of-contents__link toc-highlight">Responsiveness</a></li><li><a href="#io" class="table-of-contents__link toc-highlight">I/O</a></li><li><a href="#xctest-metrics" class="table-of-contents__link toc-highlight">XCTest Metrics</a></li><li><a href="#metrickit" class="table-of-contents__link toc-highlight">MetricKit</a></li><li><a href="#app-store-connect-api" class="table-of-contents__link toc-highlight">App Store Connect API</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">粤ICP备15029205号 Copyright © 2023 yianzhou</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1044df96.js"></script>
<script src="/assets/js/main.76ae18e3.js"></script>
</body>
</html>