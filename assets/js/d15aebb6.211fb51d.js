"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6566],{15382:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>u});var a=n(87462),r=(n(67294),n(3905));n(61839);const i={},s="SQL",l={unversionedId:"sql",id:"sql",title:"SQL",description:"\u57fa\u672c\u67e5\u8be2",source:"@site/docs/language/sql.md",sourceDirName:".",slug:"/sql",permalink:"/docs/language/sql",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Ruby",permalink:"/docs/language/ruby"}},d={},u=[{value:"\u57fa\u672c\u67e5\u8be2",id:"\u57fa\u672c\u67e5\u8be2",level:2},{value:"GROUP BY",id:"group-by",level:2},{value:"\u5f00\u7a97\u51fd\u6570",id:"\u5f00\u7a97\u51fd\u6570",level:2},{value:"\u767e\u5206\u4f4d",id:"\u767e\u5206\u4f4d",level:2},{value:"JOIN",id:"join",level:2},{value:"\u4e2d\u6587",id:"\u4e2d\u6587",level:2}],m={toc:u};function o(e){let{components:t,...i}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sql"},"SQL"),(0,r.kt)("h2",{id:"\u57fa\u672c\u67e5\u8be2"},"\u57fa\u672c\u67e5\u8be2"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM [14830].[file_key_event] AS t\nWHERE t.event_time = #relative_time:1:day:%yyyy-MM-dd HH:mm:ss%#\n    AND t.eventName = 'tech_webview_finish_navigation'\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    substring(event_time, 1, 10) as datestring\n    , count(distinct uin) as uv\n    , count(*) as pv\nfrom\n    [1035949].[file_key_event] as t\nwhere\n    t.event_time = #relative_time:14:day:%yyyy-MM-dd HH:mm:ss%#\n    and t.eventname = 'state_intelligent_label'\ngroup by\n    datestring\norder by\n    datestring desc\n")),(0,r.kt)("h2",{id:"group-by"},"GROUP BY"),(0,r.kt)("p",null,"GROUP BY \u8bed\u53e5\u7528\u4e8e\u7ed3\u5408\u5408\u8ba1\u51fd\u6570\uff0c\u6839\u636e\u4e00\u4e2a\u6216\u591a\u4e2a\u5217\u5bf9\u7ed3\u679c\u96c6\u8fdb\u884c\u5206\u7ec4\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    substring(event_time, 1, 10) as datestring\n    , ext\n    , substring(regexp_extract(extra, 'isThirdCall:[^,]*', 0), 13, 100) as isthirdcall\n    , count(distinct uin) as uv\n    , count(*) as pv\nfrom\n    [14830].[file_key_event] as t\nwhere\n    t.event_time = #relative_time:7:day:%yyyy-MM-dd HH:mm:ss%#\n    and t.eventname like 'sp_file_intro_page%'\ngroup by\n    ext\n    , datestring\n    , isthirdcall\norder by\n    datestring desc\n    , uv desc\n")),(0,r.kt)("h2",{id:"\u5f00\u7a97\u51fd\u6570"},"\u5f00\u7a97\u51fd\u6570"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT dateString,\n    isThirdInvoke,\n    uv,\n    uv * 100 / sum(uv) over(partition by dateString) as percent\nFROM (\n        SELECT SUBSTRING(event_time, 1, 10) as dateString,\n            regexp_extract(extra, 'isThirdInvoke:[^,]*', 0) as isThirdInvoke,\n            count(distinct uin) as uv\n        FROM [14830].[file_key_event] as t\n        WHERE t.event_time = #relative_time:30:day:%yyyy-MM-dd HH:mm:ss%#\n            AND t.eventName = 'doc_exposed'\n            AND regexp_extract(extra, 'isThirdInvoke:[^,]*', 0) <> ''\n        GROUP BY dateString,\n            isThirdInvoke\n    ) t1\nORDER BY dateString DESC\n")),(0,r.kt)("h2",{id:"\u767e\u5206\u4f4d"},"\u767e\u5206\u4f4d"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT t2.dateString,\n    ApproxPercentile(t2.doubleInterval, 0.3) as \u8017\u65f630\u5206\u4f4d,\n    ApproxPercentile(t2.doubleInterval, 0.5) as \u8017\u65f650\u5206\u4f4d,\n    ApproxPercentile(t2.doubleInterval, 0.7) as \u8017\u65f670\u5206\u4f4d,\n    ApproxPercentile(t2.doubleInterval, 0.9) as \u8017\u65f690\u5206\u4f4d\nFROM (\n        SELECT SUBSTRING(event_time, 1, 10) as dateString,\n            CAST(\n                split_part(\n                    regexp_extract(extra, 'interval:[^,]*', 0),\n                    ':',\n                    2\n                ) as double\n            ) as doubleInterval\n        FROM [14830].[file_key_event] as t\n        WHERE t.event_time = #relative_time:30:day:%yyyy-MM-dd HH:mm:ss%#\n            AND t.eventName = 'tech_webview_finish_navigation'\n    ) t2\nGROUP BY t2.dateString\n")),(0,r.kt)("h2",{id:"join"},"JOIN"),(0,r.kt)("p",null,"Here are the different types of the JOINs in SQL:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"(INNER) JOIN: Returns records that have matching values in both tables"),(0,r.kt)("li",{parentName:"ul"},"LEFT (OUTER) JOIN: Returns all records from the left table, and the matched records from the right table"),(0,r.kt)("li",{parentName:"ul"},"RIGHT (OUTER) JOIN: Returns all records from the right table, and the matched records from the left table"),(0,r.kt)("li",{parentName:"ul"},"FULL (OUTER) JOIN: Returns all records when there is a match in either left or right table")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"img",src:n(2374).Z,width:"1796",height:"358"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT t1.dateStr as \u65e5\u671f,\n    t1.uv as \u5927\u76d8UV,\n    t2.uv as \u6587\u4ef6UV,\n    CONCAT(\n        Cast(\n            Cast(t2.uv / t1.uv * 100 as decimal(18, 2)) as varchar(5)\n        ),\n        '%'\n    ) as \u767e\u5206\u6bd4\nFROM (\n        SELECT SUBSTRING(event_time, 1, 10) AS dateStr,\n            COUNT(distinct uin) AS uv\n        FROM [14830].[rqd_applaunched] AS t\n        WHERE t.event_time = #relative_time:30:day:%yyyy-MM-dd HH:mm:ss%#\n        GROUP BY dateStr\n    ) t1\n    LEFT JOIN (\n        SELECT SUBSTRING(event_time, 1, 10) as dateStr,\n            COUNT(distinct uin) as uv\n        FROM [14830].[file_homepage_event] as t\n        WHERE t.event_time = #relative_time:30:day:%yyyy-MM-dd HH:mm:ss%#\n            AND t.eventName = 'file_home_exposure'\n        GROUP BY dateStr\n    ) t2 ON t1.dateStr = t2.dateStr\nORDER BY \u65e5\u671f DESC\n")),(0,r.kt)("h2",{id:"\u4e2d\u6587"},"\u4e2d\u6587"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"select *\nfrom\n    [1035949].[MTT_NEW_UPLOAD_DOWNLOAD] as t\nwhere\n    t.event_time = #relative_time:7:day:%yyyy-MM-dd HH:mm:ss%#\n    and regexp_like(B25, '[\\u4e00-\\u9fa5]')\nlimit 5000\n")))}o.isMDXComponent=!0},2374:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/36F8F8B7-9271-4694-8B79-F858242D7CE1-bfb2dcd1d373a0c04a9cec0e1e573309.png"}}]);