"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9859],{20412:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>p,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var a=n(87462),i=(n(67294),n(3905)),r=n(61839);const o={},p="React",l={unversionedId:"react",id:"react",title:"React",description:"JavaScript",source:"@site/docs/dev/react.md",sourceDirName:".",slug:"/react",permalink:"/docs/dev/react",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"macOS",permalink:"/docs/dev/macos"},next:{title:"VSCode",permalink:"/docs/dev/vscode"}},s={},d=[{value:"JavaScript",id:"javascript",level:2},{value:"Node.js",id:"nodejs",level:2},{value:"npm",id:"npm",level:2},{value:"React",id:"react-1",level:2},{value:"Learn by doing",id:"learn-by-doing",level:3},{value:"Learn concepts",id:"learn-concepts",level:3},{value:"React Native",id:"react-native",level:2},{value:"Hippy",id:"hippy",level:2}],c={toc:d};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"react"},"React"),(0,i.kt)("h2",{id:"javascript"},"JavaScript"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript"},"A re-introduction to JavaScript (JS tutorial)")),(0,i.kt)("p",null,"JavaScript is designed to run as a scripting language in a ",(0,i.kt)("strong",{parentName:"p"},"host environment"),". The most common host environment is the ",(0,i.kt)("strong",{parentName:"p"},"browser"),", but JavaScript ",(0,i.kt)("strong",{parentName:"p"},"interpreters")," can also be found in a huge list of other places, including server-side environments such as ",(0,i.kt)("strong",{parentName:"p"},"Node.js"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Types"),": ",(0,i.kt)("inlineCode",{parentName:"p"},"Number"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"String"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Boolean"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Object")," (",(0,i.kt)("inlineCode",{parentName:"p"},"Function"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Array"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"Date"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"RegExp"),"), ",(0,i.kt)("inlineCode",{parentName:"p"},"Symbol")," (new in ES2015), ",(0,i.kt)("inlineCode",{parentName:"p"},"null"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"undefined"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Variables"),": In JavaScript, blocks do not have scope; only functions have a scope. So if a variable is defined using ",(0,i.kt)("inlineCode",{parentName:"p"},"var")," in a compound statement (for example inside an if control structure), ",(0,i.kt)("strong",{parentName:"p"},"it will be visible to the entire function"),". However, starting with ECMAScript 2015, ",(0,i.kt)("inlineCode",{parentName:"p"},"let")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"const")," declarations allow you to create block-scoped variables."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"let")," allows you to declare block-level variables"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"const")," allows you to declare block-level variables whose values are never intended to change"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"var")," is available from the function it is declared in")),(0,i.kt)("p",null,"JavaScript ",(0,i.kt)("strong",{parentName:"p"},"objects"),' can be thought of as simple collections of name-value pairs. The "name" is a JavaScript string, while the value can be any JavaScript value.'),(0,i.kt)("p",null,"JavaScript provides a mechanism for simultaneously declaring and invoking a function using a single expression. It\u2019s called an Immediately invoked function expression (IIFE), and the syntax for using it with an ",(0,i.kt)("strong",{parentName:"p"},"anonymous function")," looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"(function () {\n  // \u2026\n})();\n")),(0,i.kt)("p",null,"JavaScript is a prototype-based language that contains no ",(0,i.kt)("inlineCode",{parentName:"p"},"class")," statement. Instead, since functions are objects, ",(0,i.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/A_re-introduction_to_JavaScript#custom_objects"},(0,i.kt)("strong",{parentName:"a"},"JavaScript uses functions as classes")),"."),(0,i.kt)("p",null,"The keyword ",(0,i.kt)("inlineCode",{parentName:"p"},"new")," creates a brand new empty object, and then calls the function ",(0,i.kt)("inlineCode",{parentName:"p"},"Person"),", with ",(0,i.kt)("inlineCode",{parentName:"p"},"this")," set to that new object. Functions that are designed to be called by ",(0,i.kt)("inlineCode",{parentName:"p"},"new")," are called ",(0,i.kt)("strong",{parentName:"p"},"constructor functions"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'function Person(first, last) {\n  this.first = first;\n  this.last = last;\n}\nPerson.prototype.fullName = function () {\n  return this.first + " " + this.last;\n};\nPerson.prototype.fullNameReversed = function () {\n  return this.last + ", " + this.first;\n};\n\nvar s = new Person("Simon", "Willison");\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Person.prototype")," is an object shared by all instances of Person. It forms part of a ",(0,i.kt)("strong",{parentName:"p"},"prototype chain"),": any time you attempt to access a property of ",(0,i.kt)("inlineCode",{parentName:"p"},"Person")," that isn't set, JavaScript will check ",(0,i.kt)("inlineCode",{parentName:"p"},"Person.prototype")," to see if that property exists there instead. The root of this lookup chain is ",(0,i.kt)("inlineCode",{parentName:"p"},"Object.prototype"),"."),(0,i.kt)("p",null,"iOS 7\uff082013\uff09\uff0c\u82f9\u679c\u516c\u53f8\u5f00\u653e\u4e86 JavaScriptCore\uff08\u89e3\u91ca\u6267\u884c JavaScript \u4ee3\u7801\u7684\u5f15\u64ce\uff09\u3002\u6b63\u662f\u7531\u4e8e\u5b83\u7684\u6865\u6881\u4f5c\u7528\uff0c\u51fa\u73b0\u4e86\u5f88\u591a\u57fa\u4e8e JavaScriptCore \u5f00\u53d1 App \u7684\u6846\u67b6 \uff0c\u6bd4\u5982 ",(0,i.kt)("a",{parentName:"p",href:"https://cordova.apache.org/"},"Cordova"),"\uff0c",(0,i.kt)("a",{parentName:"p",href:"https://github.com/ionic-team/ionic-framework"},"ionic"),"\uff082013\uff09\u3001",(0,i.kt)("a",{parentName:"p",href:"https://github.com/facebook/react-native"},"React Native"),"\uff082015\uff09\u3001",(0,i.kt)("a",{parentName:"p",href:"https://github.com/apache/incubator-weex"},"Weex"),"\uff082016\uff09\u3001\u5c0f\u7a0b\u5e8f\uff082017\uff09\u7b49\u6846\u67b6\u3002"),(0,i.kt)("h2",{id:"nodejs"},"Node.js"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://nodejs.org/dist/latest-v16.x/docs/api/"},"Node.js"),"\xae is a JavaScript runtime built on Chrome's V8 JavaScript engine."),(0,i.kt)("p",null,"\u5b89\u88c5\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"brew install node")),(0,i.kt)("p",null,"\u8fdb\u5165 REPL (read\u2013eval\u2013print loop)\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"node")),(0,i.kt)("p",null,"\u9000\u51fa REPL\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},".exit")),(0,i.kt)("h2",{id:"npm"},"npm"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v7/commands/npm"},"npm"),": Javascript package manager."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://engineering.fb.com/2016/10/11/web/yarn-a-new-package-manager-for-javascript/"},"Yarn"),": A new package manager for JavaScript."),(0,i.kt)("p",null,"\u66f4\u65b0 npm \u81f3\u6700\u65b0\u7248\u672c\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npm install -g npm")),(0,i.kt)("p",null,"\u5982\u679c\u9879\u76ee\u5177\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," \u6587\u4ef6\uff0c\u5219\u8fd0\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," \u4f1a\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\u4e2d\u5b89\u88c5\u5176\u4e2d\u58f0\u660e\u7684 packages\u3002"),(0,i.kt)("p",null,"\u8fd0\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install lodash")," \u4f1a\u5c06\u8f6f\u4ef6\u5305\u5b89\u88c5\u5230\u5f53\u524d\u76ee\u5f55\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\u4e0b\uff0c\u5e76\u5728\u5f53\u524d\u6587\u4ef6\u5939\u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," \u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"dependencies")," \u4e2d\u6dfb\u52a0 ",(0,i.kt)("inlineCode",{parentName:"p"},"lodash")," \u6761\u76ee\u3002"),(0,i.kt)("p",null,"\u8fd0\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install -g lodash")," \u4f1a\u5c06\u8f6f\u4ef6\u5305\u5b89\u88c5\u5230\u5168\u5c40\u7684\u4f4d\u7f6e\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"npm root -g")," \u547d\u4ee4\u4f1a\u544a\u77e5\u5176\u5728\u8ba1\u7b97\u673a\u4e0a\u7684\u786e\u5207\u4f4d\u7f6e\u3002"),(0,i.kt)("p",null,"\u7528\u6237\u914d\u7f6e\u6587\u4ef6\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npm config get userconfig")," \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u3002"),(0,i.kt)("p",null,"\u8bbe\u7f6e\u4ee3\u7406\uff0c\u540c\u65f6\uff0c\u4e5f\u4f1a\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.npmrc")," \u4e2d\u66f4\u65b0\u8fd9\u4e24\u6761\u914d\u7f6e\u9879\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'npm config set proxy "http://127.0.0.1:7890"\nnpm config set https-proxy "http://127.0.0.1:7890"\n')),(0,i.kt)("p",null,"\u67e5\u770b\u914d\u7f6e\u9879\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npm config list")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," \u6587\u4ef6\u652f\u6301\u4e00\u79cd\u7528\u4e8e\u6307\u5b9a",(0,i.kt)("a",{parentName:"p",href:"http://nodejs.cn/learn/an-introduction-to-the-npm-package-manager"},"\u547d\u4ee4\u884c\u4efb\u52a1"),"\u7684\u683c\u5f0f\uff1a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "scripts": {\n    "start-dev": "node lib/server-development",\n    "start": "node lib/server-production"\n  }\n}\n')),(0,i.kt)("p",null,"\u53ef\u901a\u8fc7\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u8fd0\u884c\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npm run start"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"npm run start-dev")),(0,i.kt)("h2",{id:"react-1"},"React"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/"},"React"),": A JavaScript library for building user interfaces."),(0,i.kt)("p",null,"The React homepage contains a few small React examples with a live editor. Have a try!"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/tutorial/tutorial.html"},"Learn by doing"),", ",(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hello-world.html"},"learn concepts from the ground up"),", complementary to each other."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.taniarascia.com/getting-started-with-react/"},"React Tutorial: An Overview and Walkthrough")),(0,i.kt)("h3",{id:"learn-by-doing"},"Learn by doing"),(0,i.kt)("p",null,"\u521b\u5efa\u5de5\u7a0b\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npx create-react-app my-app")),(0,i.kt)("p",null,"By default, ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/npx"},"npx")," is a package runner tool that comes with npm. It will check whether ",(0,i.kt)("inlineCode",{parentName:"p"},"command")," exists in ",(0,i.kt)("inlineCode",{parentName:"p"},"$PATH"),", or in the local project binaries ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules/.bin"),", and execute that. If ",(0,i.kt)("inlineCode",{parentName:"p"},"command")," is not found, it will be installed prior to execution."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd my-app\nnpm start\n")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/cli/v7/commands/npm-start"},(0,i.kt)("inlineCode",{parentName:"a"},"npm start")),': This runs a predefined command specified in the "start" property of a package\'s "scripts" object.'),(0,i.kt)("p",null,"Run the app in the development mode. The page will reload if you make edits. You will also see any lint errors in the console. \u901a\u8fc7\u67e5\u770b ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," \u6587\u4ef6\u53d1\u73b0\u8fd0\u884c\u7684\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"react-scripts start")," \u6307\u4ee4\uff0c\u4f4d\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules/.bin"),"\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u987a\u5229\u7684\u8bdd\uff0c\u73b0\u5728 React \u670d\u52a1\u4f1a\u5728\u672c\u673a\u542f\u52a8\u3002Create React App doesn\u2019t handle backend logic or databases; it just creates a frontend build pipeline, so you can use it with any backend you want. Under the hood, it uses Babel and webpack."),(0,i.kt)("p",null,"When you\u2019re ready to deploy to production, running ",(0,i.kt)("inlineCode",{parentName:"p"},"npm run build")," will create an optimized build of your app in the ",(0,i.kt)("inlineCode",{parentName:"p"},"build")," folder. See ",(0,i.kt)("a",{parentName:"p",href:"https://create-react-app.dev/docs/deployment/"},"deployment"),"."),(0,i.kt)("p",null,"The React Devtools extension for Chrome lets you inspect a React component tree with your browser\u2019s developer tools."),(0,i.kt)("p",null,"Learn by doing:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Declarative, JSX"),(0,i.kt)("li",{parentName:"ul"},"props and states",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"lifting state up: pass down a function from parent to children."),(0,i.kt)("li",{parentName:"ul"},"function component (like stateless widget in flutter)"))),(0,i.kt)("li",{parentName:"ul"},"assign proper keys whenever you build dynamic lists")),(0,i.kt)("h3",{id:"learn-concepts"},"Learn concepts"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"const element = <h1>Hello, world!</h1>;")," This funny tag syntax is neither a string nor HTML. It is called ",(0,i.kt)("strong",{parentName:"p"},"JSX"),", and it is a syntax extension to JavaScript. React doesn\u2019t require using JSX, but most people do prefer it."),(0,i.kt)("p",null,"You can put any valid JavaScript expression inside the curly braces in JSX."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},'const name = "Josh Perez";\nconst element = <h1>Hello, {name}</h1>;\n')),(0,i.kt)("p",null,"React embraces the fact that rendering logic is inherently coupled with other UI logic: how events are handled, how the state changes over time, and how the data is prepared for display. Instead of putting markup and logic in separate files, React uses ",(0,i.kt)("strong",{parentName:"p"},"components")," that contain both."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Elements"),' are the smallest building blocks of React apps. Elements are what components are "made of".'),(0,i.kt)("p",null,"A function component (stateless):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"function Welcome(props) {\n  return <h1>Hello, {props.name}</h1>;\n}\n")),(0,i.kt)("p",null,"You can also use an ES6 class to define a component:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"class Welcome extends React.Component {\n  render() {\n    return <h1>Hello, {this.props.name}</h1>;\n  }\n}\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Lifecycle methods"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"componentDidMount()")," runs after the component output has been rendered to the DOM"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"componentWillUnmount()")," run before the DOM produced by the component is removed")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"this.props")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"this.state")," may be updated asynchronously, if you need to use their values, use:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"this.setState((state, props) => ({\n  counter: state.counter + props.increment,\n}));\n")),(0,i.kt)("p",null,"When you define a component using an ES6 class, a common pattern is for an ",(0,i.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/handling-events.html"},(0,i.kt)("strong",{parentName:"a"},"event handler"))," to be a method on the class. We generally recommend ",(0,i.kt)("strong",{parentName:"p"},"binding")," in the constructor or using the class fields syntax."),(0,i.kt)("h2",{id:"react-native"},"React Native"),(0,i.kt)("p",null,"\u521b\u5efa\u5de5\u7a0b\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npx react-native init MyTestApp")),(0,i.kt)("p",null,"\u8fd0\u884c\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"npx react-native run-ios")),(0,i.kt)("p",null,"\u4ece ",(0,i.kt)("inlineCode",{parentName:"p"},"AppDelegate")," \u5f00\u59cb\u63a2\u7d22\uff1a"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u521d\u59cb\u5316 ",(0,i.kt)("inlineCode",{parentName:"li"},"RCTBridge"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"RCTCxxBridge"),"\uff0c\u6ce8\u518c\u8981\u66b4\u9732\u7ed9 JavaScript \u8c03\u7528\u7684 native modules"),(0,i.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u4e00\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"dispatch_group_t")," \u6765\u5e76\u53d1\u6267\u884c\u4e09\u4e2a\u4efb\u52a1\uff1a\u539f\u751f\u6a21\u5757\u521d\u59cb\u5316\u3001JS \u73af\u5883\u521d\u59cb\u5316\u3001JS \u8d44\u6e90\u52a0\u8f7d"),(0,i.kt)("li",{parentName:"ul"},"\u4e09\u4e2a\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u5f00\u59cb\u6267\u884c JavaScript \u4ee3\u7801")),(0,i.kt)(r.G,{chart:"sequenceDiagram\n    participant AppDelegate as AppDelegate.m\n    participant RCTBridge as RCTBridge.m\n    participant RCTCxxBridge as RCTCxxBridge.mm\n    participant Instance as Instance.cpp\n    participant RCTJavaScriptLoader as RCTJavaScriptLoader.mm\n    AppDelegate->>RCTBridge: initWithDelegate:launchOptions:\n    RCTBridge->>RCTBridge: setup\n    RCTBridge->>RCTCxxBridge: initWithParentBridge:\n    RCTCxxBridge->>RCTCxxBridge: start\n    RCTCxxBridge->>RCTCxxBridge: registerExtraModules\n    RCTCxxBridge->>Instance: new\n    par mainThread\n    RCTCxxBridge->>RCTCxxBridge: _initializeModules:withDispatchGroup:lazilyDiscovered:\n    and _jsThread\n    RCTCxxBridge->>RCTCxxBridge: _initializeBridge:\n    RCTCxxBridge->>RCTCxxBridge: _initializeBridgeLocked:\n    RCTCxxBridge->>Instance: initializeBridge\n    and mainThread\n    RCTCxxBridge->>RCTCxxBridge: loadSource:onProgress:\n    RCTCxxBridge->>RCTJavaScriptLoader: loadBundleAtURL:onProgress:onComplete:\n    alt is fileUrl\n    RCTJavaScriptLoader->>RCTJavaScriptLoader: attemptSynchronousLoadOfBundleAtURL\n    else is remoteUrl\n    RCTJavaScriptLoader->>RCTJavaScriptLoader: attemptAsynchronousLoadOfBundleAtURL\n    end\n    end\n    RCTCxxBridge->>RCTCxxBridge: executeSourceCode:sync:",mdxType:"Mermaid"}),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objc"},'// AppDelegate.m\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions\n{\n  RCTBridge *bridge = [[RCTBridge alloc] initWithDelegate:self launchOptions:launchOptions];\n  RCTRootView *rootView = [[RCTRootView alloc] initWithBridge:bridge\n                                                   moduleName:@"MyTestApp"\n                                            initialProperties:nil];\n}\n\n// RCTBridge.m\n- (void)setUp\n{\n  Class bridgeClass = self.bridgeClass;\n  self.batchedBridge = [[bridgeClass alloc] initWithParentBridge:self];\n  [self.batchedBridge start];\n}\n\n// RCTCxxBridge.mm\n- (void)start\n{\n  [[NSNotificationCenter defaultCenter] postNotificationName:RCTJavaScriptWillStartLoadingNotification\n                                                      object:_parentBridge\n                                                    userInfo:@{@"bridge" : self}];\n  // Set up the JS thread early\n  // \u7ed1\u5b9a RunLoop \u4f7f\u7ebf\u7a0b\u4e0d\u9000\u51fa\n  _jsThread = [[NSThread alloc] initWithTarget:[self class] selector:@selector(runRunLoop) object:nil];\n  _jsThread.name = RCTJSThreadName;\n  _jsThread.qualityOfService = NSOperationQualityOfServiceUserInteractive;\n  [_jsThread start];\n\n  dispatch_group_t prepareBridge = dispatch_group_create();\n\n  // \u6ce8\u518c\u6240\u6709\u8981\u66b4\u9732\u7ed9 JS \u8c03\u7528\u7684 native module\n  [self registerExtraModules];\n  // Initialize all native modules that cannot be loaded lazily\n  (void)[self _initializeModules:RCTGetModuleClasses() withDispatchGroup:prepareBridge lazilyDiscovered:NO];\n  [self registerExtraLazyModules]; // debug only\n\n  // This doesn\'t really do anything.  The real work happens in initializeBridge.\n  _reactInstance.reset(new Instance);\n\n  __weak RCTCxxBridge *weakSelf = self;\n\n  // Prepare executor factory (shared_ptr for copy into block)\n  std::shared_ptr<JSExecutorFactory> executorFactory;\n  auto installBindings = RCTJSIExecutorRuntimeInstaller(nullptr);\n  executorFactory = std::make_shared<JSCExecutorFactory>(installBindings);\n\n  // Dispatch the instance initialization as soon as the initial module metadata has\n  // been collected (see initModules)\n  dispatch_group_enter(prepareBridge);\n  [self ensureOnJavaScriptThread:^{\n    [weakSelf _initializeBridge:executorFactory];\n    dispatch_group_leave(prepareBridge);\n  }];\n\n  // Load the source asynchronously, then store it for later execution.\n  dispatch_group_enter(prepareBridge);\n  __block NSData *sourceCode;\n  [self\n      loadSource:^(NSError *error, RCTSource *source) {\n        sourceCode = source.data;\n        dispatch_group_leave(prepareBridge);\n      }\n      onProgress:^(RCTLoadingProgress *progressData) {\n      }];\n\n  // Wait for both the modules and source code to have finished loading\n  dispatch_group_notify(prepareBridge, dispatch_get_global_queue(QOS_CLASS_USER_INTERACTIVE, 0), ^{\n    RCTCxxBridge *strongSelf = weakSelf;\n    if (sourceCode && strongSelf.loading) {\n      [strongSelf executeSourceCode:sourceCode sync:NO];\n    }\n  });\n}\n')),(0,i.kt)("p",null,"\u63a5\u4e0b\u6765\u770b JavaScript \u73af\u5883\u7684\u521d\u59cb\u5316\uff08\u53d1\u751f\u5728 JS \u7ebf\u7a0b\uff09\uff1a"),(0,i.kt)(r.G,{chart:"sequenceDiagram\n    participant RCTCxxBridge as RCTCxxBridge.mm\n    participant RCTMessageThread as RCTMessageThread.mm\n    participant Instance as Instance.cpp\n    participant NativeToJsBridge as NativeToJsBridge.cpp\n    participant JSIExecutor as JSIExecutor.cpp\n    RCTCxxBridge->>RCTCxxBridge: _initializeBridge:\n    RCTCxxBridge->>RCTMessageThread: make_shared\n    RCTCxxBridge->>RCTCxxBridge: _initializeBridgeLocked:\n    RCTCxxBridge->>Instance: initializeBridge\n    Instance->>NativeToJsBridge: make_shared\n    NativeToJsBridge->>JSIExecutor: make_unique\n    Instance->>NativeToJsBridge: initializeRuntime\n    NativeToJsBridge->>JSIExecutor: initializeRuntime",mdxType:"Mermaid"}),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"RCTMessageThread")," \u7ee7\u627f\u81ea ",(0,i.kt)("inlineCode",{parentName:"p"},"MessageQueueThread"),"\uff0c\u662f\u5b83\u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\u3002\u5b9e\u9645\u4e0a\u5b83\u505a\u7684\u5c31\u662f\u5c06 JS \u7ebf\u7a0b\u7684 RunLoop \u65e0\u7f1d\u6865\u63a5\u6210 CoreFoundation \u5bf9\u8c61\u5e76\u6301\u6709\u3002\u5f53\u6709\u4efb\u52a1\u9700\u8981\u6267\u884c\u65f6\u5c31\u6d3e\u53d1\u5230\u8fd9\u4e2a RunLoop \u4e2d\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Instance")," \u662f\u505a\u4ec0\u4e48\u7684\uff1f"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"NativeToJsBridge")," ? ",(0,i.kt)("inlineCode",{parentName:"p"},"JsToNativeBridge")," ?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"JSIExecutor")," ?"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"TurboModule")," ?"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-objc"},"// RCTCxxBridge.mm\n- (void)_initializeBridge:(std::shared_ptr<JSExecutorFactory>)executorFactory\n{\n  _jsMessageThread = std::make_shared<RCTMessageThread>([NSRunLoop currentRunLoop], ^(NSError *error) {});\n  if (_reactInstance) {\n    [self _initializeBridgeLocked:executorFactory];\n  }\n}\n\n- (void)_initializeBridgeLocked:(std::shared_ptr<JSExecutorFactory>)executorFactory\n{\n  std::lock_guard<std::mutex> guard(_moduleRegistryLock);\n  // This is async, but any calls into JS are blocked by the m_syncReady CV in Instance\n  _reactInstance->initializeBridge(\n      std::make_unique<RCTInstanceCallback>(self),\n      executorFactory,\n      _jsMessageThread,\n      [self _buildModuleRegistryUnlocked]);\n  _moduleRegistryCreated = YES;\n}\n\n// Instance.cpp\nvoid Instance::initializeBridge(\n    std::unique_ptr<InstanceCallback> callback,\n    std::shared_ptr<JSExecutorFactory> jsef,\n    std::shared_ptr<MessageQueueThread> jsQueue,\n    std::shared_ptr<ModuleRegistry> moduleRegistry) {\n  callback_ = std::move(callback);\n  moduleRegistry_ = std::move(moduleRegistry);\n  jsQueue->runOnQueueSync([this, &jsef, jsQueue]() mutable {\n    nativeToJsBridge_ = std::make_shared<NativeToJsBridge>(\n        jsef.get(), moduleRegistry_, jsQueue, callback_);\n    nativeToJsBridge_->initializeRuntime();\n    jsCallInvoker_->setNativeToJsBridgeAndFlushCalls(nativeToJsBridge_);\n    std::lock_guard<std::mutex> lock(m_syncMutex);\n    m_syncReady = true;\n    m_syncCV.notify_all();\n  });\n}\n")),(0,i.kt)("h2",{id:"hippy"},"Hippy"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/Tencent/Hippy/"},"https://github.com/Tencent/Hippy/")),(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("a",{parentName:"p",href:"https://hippyjs.org/"},"https://hippyjs.org/"))),(0,i.kt)("p",null,"clone \u4ee3\u7801\u4ed3\u5e93\uff1a",(0,i.kt)("inlineCode",{parentName:"p"},"git clone https://github.com/Tencent/Hippy.git"),"\uff0c\u6309\u7167",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Tencent/Hippy/blob/master/README.zh_CN.md"},"\u6559\u7a0b"),"\u5b89\u88c5\u3002"),(0,i.kt)("p",null,"\u9047\u5230\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\uff1a\u66f4\u65b0 npm \u7684\u7248\u672c\uff1b",(0,i.kt)("inlineCode",{parentName:"p"},"npm audit fix"),"\uff1b\u8bbe\u7f6e\u4ee3\u7406\u3001\u7f51\u7edc\u6ce2\u52a8\u65f6\u591a\u8bd5\u51e0\u6b21\u3002"))}u.isMDXComponent=!0}}]);