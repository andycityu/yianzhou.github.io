"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6968],{32486:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>c,frontMatter:()=>n,metadata:()=>o,toc:()=>s});var a=r(87462),l=(r(67294),r(3905));r(61839);const n={},i="Flutter Principle",o={unversionedId:"flutter-principle",id:"flutter-principle",title:"Flutter Principle",description:"Flutter vs React Native \u6027\u80fd\u5bf9\u6bd4",source:"@site/docs/flutter/flutter-principle.md",sourceDirName:".",slug:"/flutter-principle",permalink:"/docs/flutter/flutter-principle",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Flutter Primer",permalink:"/docs/flutter/"},next:{title:"Flutter Source",permalink:"/docs/flutter/flutter-source"}},u={},s=[{value:"Flutter vs React Native \u6027\u80fd\u5bf9\u6bd4",id:"flutter-vs-react-native-\u6027\u80fd\u5bf9\u6bd4",level:2},{value:"Declarative UI",id:"declarative-ui",level:2},{value:"Flutter architectural overview",id:"flutter-architectural-overview",level:2},{value:"\u4e09\u68f5\u6811",id:"\u4e09\u68f5\u6811",level:2},{value:"\u56db\u4e2a\u7ebf\u7a0b",id:"\u56db\u4e2a\u7ebf\u7a0b",level:2},{value:"120 Hz",id:"120-hz",level:2},{value:"Garbage Collector",id:"garbage-collector",level:2}],p={toc:s};function c(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"flutter-principle"},"Flutter Principle"),(0,l.kt)("h2",{id:"flutter-vs-react-native-\u6027\u80fd\u5bf9\u6bd4"},"Flutter vs React Native \u6027\u80fd\u5bf9\u6bd4"),(0,l.kt)("p",null,"Flutter (written in Dart) -> Skia (written in C/C++) -> OpenGL/Metal -> GPU -> Frame Buffer"),(0,l.kt)("p",null,"Flutter \u5229\u7528 Skia \u7ed8\u56fe\u5f15\u64ce\uff0c\u76f4\u63a5\u901a\u8fc7 CPU\u3001GPU \u8fdb\u884c\u7ed8\u5236\uff0c\u4e0d\u9700\u8981\u4f9d\u8d56\u4efb\u4f55\u539f\u751f\u7684\u63a7\u4ef6\u3002Skia \u5f15\u64ce\u4f1a\u5c06 Dart \u89c6\u56fe\u7ed3\u6784\u6570\u636e\u52a0\u5de5\u6210 GPU \u6570\u636e\uff0c\u4ea4\u7531 OpenGL \u6700\u7ec8\u63d0\u4f9b\u7ed9 GPU \u6e32\u67d3\u3002"),(0,l.kt)("p",null,"React Native(JSX) -> JavaScript (JS Bundle) -> JavaScriptCore -> Bridge -> iOS (OC/Swift) -> CoreAnimation -> OpenGL/Metal -> GPU -> Frame Buffer"),(0,l.kt)("p",null,"\u901a\u8fc7 JavaScript \u865a\u62df\u673a\u6269\u5c55\u8c03\u7528\u7cfb\u7edf\u7ec4\u4ef6\uff0c\u7531 Android \u548c iOS \u8fdb\u884c\u7ec4\u4ef6\u7684\u6e32\u67d3\u3002"),(0,l.kt)("p",null,"Flutter \u662f\u91cd\u5199\u4e86\u4e00\u6574\u5957\u5305\u62ec\u5e95\u5c42\u6e32\u67d3\u903b\u8f91\u548c\u4e0a\u5c42\u5f00\u53d1\u8bed\u8a00\u7684\u5b8c\u6574\u89e3\u51b3\u65b9\u6848\u3002Dart \u662f\u5c11\u6570\u540c\u65f6\u652f\u6301 JIT\uff08Just In Time\uff0c\u5373\u65f6\u7f16\u8bd1\uff09\u548c AOT\uff08Ahead of Time\uff0c\u8fd0\u884c\u524d\u7f16\u8bd1\uff09\u7684\u8bed\u8a00\u3002\u53ef\u4ee5\u4fdd\u8bc1\u89c6\u56fe\u6e32\u67d3\u5728 Android \u548c iOS \u4e0a\u7684\u9ad8\u5ea6\u4e00\u81f4\u6027\uff1b\u5728\u4ee3\u7801\u6267\u884c\u6548\u7387\u548c\u6e32\u67d3\u6027\u80fd\u4e0a\u4e5f\u53ef\u4ee5\u5ab2\u7f8e\u539f\u751f App\u3002"),(0,l.kt)("p",null,"\u5728\u5f00\u53d1\u671f\u4f7f\u7528 JIT\uff0c\u652f\u6301\u6709\u72b6\u6001\u7684\u70ed\u91cd\u8f7d\uff0c\u5f00\u53d1\u6548\u7387\u6781\u9ad8\uff1b\u800c\u53d1\u5e03\u671f\u4f7f\u7528 AOT\uff0c\u4ee3\u7801\u6267\u884c\u66f4\u9ad8\u6548\uff0c\u4ee3\u7801\u6027\u80fd\u548c\u7528\u6237\u4f53\u9a8c\u4e5f\u66f4\u5353\u8d8a\u3002"),(0,l.kt)("p",null,"Flutter apps run in a VM that offers stateful hot reload of changes without needing a full recompile. For release, Flutter apps are compiled directly to machine code (Intel x64 or ARM instructions)."),(0,l.kt)("p",null,"Dart \u907f\u514d\u4e86\u62a2\u5360\u5f0f\u8c03\u5ea6\u548c\u5171\u4eab\u5185\u5b58\uff0c\u53ef\u4ee5\u5728\u6ca1\u6709\u9501\u7684\u60c5\u51b5\u4e0b\u8fdb\u884c\u5bf9\u8c61\u5206\u914d\u548c\u5783\u573e\u56de\u6536\uff0c\u5728\u6027\u80fd\u65b9\u9762\u8868\u73b0\u76f8\u5f53\u4e0d\u9519\u3002"),(0,l.kt)("h2",{id:"declarative-ui"},"Declarative UI"),(0,l.kt)("p",null,"Frameworks from Win32 to web to Android and iOS typically use an imperative \u547d\u4ee4\u5f0f style of UI programming. You manually construct a full-functioned UI entity, such as a UIView or equivalent, and later mutate it using methods and setters when the UI changes. \uff08\u63a7\u5236\u5668\u6301\u6709 UIView \u7684\u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528\u5b9e\u4f8b\u65b9\u6cd5\uff09"),(0,l.kt)("p",null,"In order to lighten the burden on developers from having to program how to ",(0,l.kt)("strong",{parentName:"p"},"transition between various UI states"),", Flutter, by contrast, lets the developer describe the current UI state and leaves the transitioning to the framework."),(0,l.kt)("p",null,"Here, rather than mutating an UIView instance when the UI changes, Flutter constructs new Widget instances. The framework manages many of the responsibilities of a traditional UI object (such as maintaining the state of the layout) behind the scenes with ",(0,l.kt)("inlineCode",{parentName:"p"},"RenderObjects"),". RenderObjects persist between frames and Flutter\u2019s lightweight Widgets tell the framework to mutate the RenderObjects between states. The Flutter framework handles the rest."),(0,l.kt)("h2",{id:"flutter-architectural-overview"},"Flutter architectural overview"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"https://flutter.dev/docs/resources/architectural-overview"},"Flutter architectural overview"),"\u3002")),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"img",src:r(34144).Z})),(0,l.kt)("p",null,"Most developers will interact with Flutter via the Flutter Framework. The ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/flutter/engine"},"Flutter Engine")," is a portable runtime for hosting Flutter applications. It implements Flutter's core libraries, including animation and graphics, file and network I/O, accessibility support, plugin architecture, and a Dart runtime and compile toolchain."),(0,l.kt)("h2",{id:"\u4e09\u68f5\u6811"},"\u4e09\u68f5\u6811"),(0,l.kt)("p",null,"Widget \u6811\uff1a\u5f00\u53d1\u8005\u5199\u7684 dart \u4ee3\u7801\uff0c\u5bf9\u56fe\u5f62\u5316\u754c\u9762\u7684\u63cf\u8ff0/\u84dd\u56fe\u3002"),(0,l.kt)("p",null,"Element \u6811\uff1aElement \u4e0e Widget \u4e00\u4e00\u5bf9\u5e94\uff0cFlutter \u5f15\u64ce\u7ef4\u62a4\u7ba1\u7406\uff0c\u5e76\u5728 ",(0,l.kt)("inlineCode",{parentName:"p"},"setState")," \u65f6\u5bf9\u6bd4\u3001\u5237\u65b0\u3002"),(0,l.kt)("p",null,"Render \u6811\uff1a\u5df2\u5e03\u5c40\u5b8c\u6bd5\uff0c\u6240\u6709\u5143\u7d20\u7684\u4f4d\u7f6e\u3001\u5bbd\u9ad8\uff0c\u56fe\u7247\u3001\u7eb9\u7406\u7b49\u4fe1\u606f\u90fd\u5df2\u786e\u5b9a\uff0c\u53ef\u4ee5\u4ea4\u7ed9 Skia \u5f15\u64ce\u7ed8\u56fe\u7684\u6811\u3002"),(0,l.kt)("p",null,"When your app creates and displays a scene, the UI thread creates a ",(0,l.kt)("strong",{parentName:"p"},"layer tree"),", a lightweight object containing device-agnostic painting commands, and sends the layer tree to the raster thread to be rendered on the device."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"PlatformView")," \u5230\u4e86 iOS \u5e73\u53f0\u4e0a\u662f\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"UIView"),"\uff0c\u5982\u679c Widget \u6811\u91cc\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"PlatformView"),"\uff0c\u90a3\u4e48\u5b83\u4f1a\u4ee5 ",(0,l.kt)("inlineCode",{parentName:"p"},"UIView")," \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"subview")," \u5f62\u5f0f\u5b58\u5728\u3002"),(0,l.kt)("h2",{id:"\u56db\u4e2a\u7ebf\u7a0b"},"\u56db\u4e2a\u7ebf\u7a0b"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"UI thread: All of your Dart code runs on the UI thread. The UI thread executes Dart code in the Dart VM."),(0,l.kt)("li",{parentName:"ul"},"Platform thread: The platform\u2019s main thread. Plugin code runs here."),(0,l.kt)("li",{parentName:"ul"},"Raster thread: Skia, the graphics library, runs on this thread. \u63a5\u53d7 UI thread \u521b\u5efa\u7684 layer tree\uff0c\u8f93\u51fa\u5149\u6805\u5316\u56fe\u50cf\uff0c\u7136\u540e\u5c06\u5149\u6805\u5316\u7684\u6570\u636e\u4ea4\u7ed9 GPU \u7ed8\u5236\u3002"),(0,l.kt)("li",{parentName:"ul"},"I/O thread: Performs expensive tasks (mostly I/O) that would otherwise block either the UI or raster threads.")),(0,l.kt)("h2",{id:"120-hz"},"120 Hz"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://juejin.cn/post/7081273509690736653"},"Flutter 120hz \u9ad8\u5237\u65b0\u7387\u5728 Android \u548c iOS \u4e0a\u7684\u8c03\u7814\u603b\u7ed3 - \u6398\u91d1")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.google.com/document/d/1O-ot6MydAl5pAr_XGnpR-Qq5A5CPDF6edaPu8xQtgCQ/edit?resourcekey=0-LlXeGtGRC67XL4NrGoc91A"},"Support Variable Refresh Rate Displays (PUBLICLY SHARED) - Google Docs")),(0,l.kt)("h2",{id:"garbage-collector"},"Garbage Collector"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://docs.flutter.dev/development/tools/devtools/memory"},"Using the Memory view | Flutter")),(0,l.kt)("p",null,"\u5b98\u65b9\u6587\u6863\u91cc\u5f15\u7528\u7684\u6587\u7ae0\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://medium.com/flutter/flutter-dont-fear-the-garbage-collector-d69b3ff1ca30"},"Flutter: Don\u2019t Fear the Garbage Collector | by Matt Sullivan | Flutter | Medium")),(0,l.kt)("p",null,"Dart \u5783\u573e\u56de\u6536\uff1a\u5206\u4ee3\u7684\uff0c\u4e24\u6b65\uff1a\u65b0\u751f\u4ee3 Young Space Scavenger\u3001\u8001\u751f\u4ee3 Parallel Marking and Concurrent Sweeping"),(0,l.kt)("p",null,"\u65b0\u751f\u4ee3\uff08Cheney \u7b97\u6cd5\uff09\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9488\u5bf9\u751f\u547d\u5468\u671f\u5f88\u77ed\u7684\u5bf9\u8c61\uff0c\u4f8b\u5982 ",(0,l.kt)("inlineCode",{parentName:"li"},"StatelessWidget"),"\u3002\u963b\u585e\u7684\uff0c\u4f46\u6bd4\u7b2c\u4e8c\u4ee3\u7b97\u6cd5\u5feb\u5f97\u591a\uff0c\u7ed3\u5408\u7a7a\u95f2\u65f6\u8c03\u5ea6\uff0c\u6d88\u9664\u53ef\u611f\u77e5\u7684\u5361\u987f\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u65b0\u5bf9\u8c61\u88ab\u5206\u914d\u5728\u8fde\u7eed\u7684\u5185\u5b58\u5757\uff08\u4e0e malloc \u4e0d\u540c\uff09"),(0,l.kt)("li",{parentName:"ul"},"\u65b0\u5bf9\u8c61\u88ab\u5206\u914d\u7684\u7a7a\u95f4\u5206\u4e3a\u4e24\u4e2a\u201c\u534a\u7a7a\u95f4\u201d\uff0c\u65b0\u5bf9\u8c61\u88ab\u5206\u914d\u5728\u6d3b\u8dc3\u7684\u534a\u7a7a\u95f4\uff0c\u5f53\u5b83\u6ee1\u4e86\uff0c\u5c31\u628a\u4ecd\u7136\u5b58\u6d3b\u7684\u5bf9\u8c61\u62f7\u8d1d\u5230\u4e0d\u6d3b\u8dc3\u7684\u534a\u7a7a\u95f4")),(0,l.kt)("p",null,"Bump pointer works by allocating memory from a contiguous block of memory and keeping track of the next available address to allocate. When a new object needs to be allocated, the garbage collector simply moves the pointer to the next available address and returns it. This is a simple and efficient method of allocation, but it can lead to fragmentation of the memory block."),(0,l.kt)("p",null,"malloc does not require a contiguous block of memory. Instead, it searches for a free block of memory of the requested size and returns a pointer to that block. This can lead to more efficient use of memory and less fragmentation, but it also requires more bookkeeping overhead."),(0,l.kt)("p",null,"\u8001\u751f\u4ee3\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u90a3\u4e9b\u5728\u4e0a\u4e00\u9636\u6bb5\u6ca1\u6709\u88ab\u56de\u6536\u7684\uff0c\u4f1a\u6210\u4e3a\u8001\u751f\u4ee3"),(0,l.kt)("li",{parentName:"ul"},"\u4e24\u6b65\uff1a\u904d\u5386\u5bf9\u8c61\u5f15\u7528\u56fe\uff0c\u6807\u8bb0\u5b58\u6d3b\u7684\u5bf9\u8c61\uff1b\u626b\u63cf\u5168\u90e8\u5185\u5b58\uff0c\u6e05\u695a\u672a\u88ab\u6807\u8bb0\u7684\u5bf9\u8c61"),(0,l.kt)("li",{parentName:"ul"},"\u6bd4\u8f83\u6162\uff0c\u4f46\u662f\u53d1\u751f\u9891\u7387\u5f88\u4f4e")))}c.isMDXComponent=!0},34144:(e,t,r)=>{r.d(t,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6ZDA1MWY1Njc0YmI0NmQ4NzgxOTgwMzQ5YTY2OTc3NjRhMDgyNGM0NjI2MGE3M2ZjYzdhNTQwZTNmOGEyODhjZQpzaXplIDIzNDcyOQo="}}]);