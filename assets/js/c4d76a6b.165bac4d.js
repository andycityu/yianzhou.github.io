"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1891],{87068:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>p,toc:()=>m});var a=t(87462),o=(t(67294),t(3905));t(61839);const i={sidebar_position:2},l="KVO",p={unversionedId:"Objective-C/kvo",id:"Objective-C/kvo",title:"KVO",description:"\u539f\u7406",source:"@site/docs/language/Objective-C/kvo.md",sourceDirName:"Objective-C",slug:"/Objective-C/kvo",permalink:"/docs/language/Objective-C/kvo",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"NSObject",permalink:"/docs/language/Objective-C/nsobject"},next:{title:"Category",permalink:"/docs/language/Objective-C/category"}},d={},m=[{value:"\u539f\u7406",id:"\u539f\u7406",level:2},{value:"KVC",id:"kvc",level:2}],s={toc:m};function c(e){let{components:n,...i}=e;return(0,o.kt)("wrapper",(0,a.Z)({},s,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"kvo"},"KVO"),(0,o.kt)("h2",{id:"\u539f\u7406"},"\u539f\u7406"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOImplementation.html"},"Key-Value Observing Implementation Details")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'- (void)viewDidLoad {\n    [super viewDidLoad];\n\n    self.demo1 = [[DemoObject alloc] init];\n    self.demo2 = [[DemoObject alloc] init];\n\n    NSKeyValueObservingOptions options = NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld;\n    [self.demo1 addObserver:self forKeyPath:@"count" options:options context:nil];\n\n    NSLog(@"%@", object_getClass(self.demo1)); // NSKVONotifying_DemoObject\n    NSLog(@"%@", object_getClass(self.demo2)); // DemoObject\n}\n\n- (void)observeValueForKeyPath:(NSString *)keyPath\n                      ofObject:(id)object\n                        change:(NSDictionary<NSKeyValueChangeKey,id> *)change\n                       context:(void *)context {\n    NSLog(@"%@", keyPath);\n    NSLog(@"%@", object);\n    NSLog(@"%@", change);\n}\n')),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6dfb\u52a0\u4e86 KVO \u89c2\u5bdf\u8005\u540e\uff0c\u5bf9\u8c61\u7684\u7c7b\u53d1\u751f\u4e86\u6539\u53d8\u3002\u5b9e\u9645\u4e0a\u662f\u7cfb\u7edf\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u4e3a ",(0,o.kt)("inlineCode",{parentName:"p"},"DemoObject")," \u521b\u5efa\u4e86\u5b50\u7c7b ",(0,o.kt)("inlineCode",{parentName:"p"},"NSKVONotifying_DemoObject"),"\uff0c\u5e76\u5c06 ",(0,o.kt)("inlineCode",{parentName:"p"},"demo1")," \u5b9e\u4f8b\u5bf9\u8c61\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"isa")," \u6307\u9488\u6307\u5411\u4e86\u8fd9\u4e2a\u65b0\u7684\u5b50\u7c7b\u3002\u7136\u540e\uff0c\u901a\u8fc7\u91cd\u5199\u5b50\u7c7b\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"set")," \u65b9\u6cd5\uff0c\u6765\u5b9e\u73b0 KVO\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:t(29126).Z})),(0,o.kt)("p",null,"\u901a\u8fc7\u65ad\u70b9\u8c03\u8bd5\u6253\u5370\u65b9\u6cd5\u7684\u5b9e\u73b0\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6dfb\u52a0\u89c2\u5bdf\u8005\u540e\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"setCount:")," \u7684\u65b9\u6cd5\u5b9e\u73b0\u53d8\u6210\u4e86 Foundation \u5185\u90e8\u7684\u65b9\u6cd5 ",(0,o.kt)("inlineCode",{parentName:"p"},"_NSSetIntValueAndNotify"),"\uff08\u6839\u636e\u5c5e\u6027\u7684\u4e0d\u540c\u7c7b\u578b\uff0cFoundation \u5185\u90e8\u4f1a\u8c03\u7528\u4e0d\u540c\u7684\u65b9\u6cd5\uff09\u3002"),(0,o.kt)("p",null,"\u7531\u4e8e KVO \u7684\u5173\u952e\u662f\u91cd\u5199 ",(0,o.kt)("inlineCode",{parentName:"p"},"set")," \u65b9\u6cd5\uff0c\u56e0\u6b64\u76f4\u63a5\u4fee\u6539\u6210\u5458\u53d8\u91cf\u663e\u7136\u662f\u4e0d\u53ef\u80fd\u89e6\u53d1 KVO \u7684\u3002"),(0,o.kt)("p",null,"KVO \u7684\u5185\u90e8\u5b9e\u73b0\u662f\u7c7b\u4f3c\u4e8e\u8fd9\u6837\u7684\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'- (void)setCount:(NSUInteger)count {\n    _NSSetIntValueAndNotify();\n}\n\nvoid _NSSetIntValueAndNotify() {\n    [self willChangeValueForKey:@"count"];\n    [super setCount:count];\n    [self didChangeValueForKey:@"count"];\n}\n\n- (void)didChangeValueForKey:(NSString *)key {\n    // \u5728\u8fd9\u91cc\u901a\u77e5\u89c2\u5bdf\u8005\n}\n')),(0,o.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7 runtime \u6253\u5370 ",(0,o.kt)("inlineCode",{parentName:"p"},"NSKVONotifying_DemoObject")," \u7c7b\u5bf9\u8c61\u91cc\u7684\u65b9\u6cd5\u5217\u8868\uff0c\u6765\u7aa5\u63a2\u5176\u5185\u90e8\u5b9e\u73b0\u4e86\u54ea\u4e9b\u65b9\u6cd5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'- (void)printMethodListWithClass:(Class)cls {\n    unsigned int count = 0;\n    Method *methodList = class_copyMethodList(cls, &count);\n    for (int i = 0; i < count; i++) {\n        Method *method = &methodList[i];\n        NSString *name = NSStringFromSelector(method_getName(*method));\n        NSLog(@"%@", name);\n    }\n    free(methodList);\n}\n\n/** \u8f93\u51fa\uff1a\n2022-06-26 17:01:27.445053+0800 ocdemo[15670:4354180] setCount:\n2022-06-26 17:01:27.445115+0800 ocdemo[15670:4354180] class\n2022-06-26 17:01:27.445161+0800 ocdemo[15670:4354180] dealloc\n2022-06-26 17:01:27.445196+0800 ocdemo[15670:4354180] _isKVOA\n*/\n')),(0,o.kt)("p",null,"\u5982\u679c\u5e0c\u671b\u624b\u52a8\u89e6\u53d1 KVO\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"willChangeValueForKey:")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"didChangeValueForKey:")," \u6765\u89e6\u53d1\u3002"),(0,o.kt)("h2",{id:"kvc"},"KVC"),(0,o.kt)("p",null,"KVC \u6307\u7684\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"NSObject")," \u9075\u5faa\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"NSKeyValueCoding")," \u534f\u8bae\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"- valueForKey:\n- valueForKeyPath:\n- setValue:forKey:\n- setValue:forKeyPath:\n")),(0,o.kt)("p",null,"KVC \u8d4b\u503c\u7684\u5168\u8fc7\u7a0b\uff08\u53d6\u503c\u7684\u5168\u8fc7\u7a0b\u4e0e\u8d4b\u503c\u662f\u7c7b\u4f3c\u7684\uff09\uff1a"),(0,o.kt)("p",null,"\u9996\u5148\uff0c\u627e ",(0,o.kt)("inlineCode",{parentName:"p"},"set")," \u65b9\u6cd5\u5e76\u8c03\u7528\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:t(4974).Z})),(0,o.kt)("p",null,"\u5982\u679c\u6ca1\u6709 ",(0,o.kt)("inlineCode",{parentName:"p"},"set")," \u65b9\u6cd5\uff0c\u5219\u627e ",(0,o.kt)("inlineCode",{parentName:"p"},"_set")," \u65b9\u6cd5\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:t(24362).Z})),(0,o.kt)("p",null,"\u5982\u679c\u8fd8\u627e\u4e0d\u5230\uff0c\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"+accessInstanceVariablesDirectly")," \u8fd4\u56de ",(0,o.kt)("inlineCode",{parentName:"p"},"YES")," \u7684\u524d\u63d0\u4e0b\uff0c\u4f1a\u5c1d\u8bd5\u76f4\u63a5\u8bbf\u95ee\u6210\u5458\u53d8\u91cf\uff0c\u5e76\u6309\u7167 ",(0,o.kt)("inlineCode",{parentName:"p"},"_age"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"_isAge"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"age"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"isAge")," \u7684\u987a\u5e8f\u6765\u67e5\u627e\u6210\u5458\u53d8\u91cf\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:t(72628).Z})),(0,o.kt)("p",null,"KVC \u7684\u65b9\u6cd5\u8c03\u7528\u4f1a\u89e6\u53d1 KVO\uff0c\u54ea\u6015\u5bf9\u8c61\u6ca1\u6709 ",(0,o.kt)("inlineCode",{parentName:"p"},"set")," \u65b9\u6cd5\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"img",src:t(98033).Z})))}c.isMDXComponent=!0},98033:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6NGJjZjNmZmVjMzQyOGZiNjJmZTA4OGI3NzMzYTU5YmRjZmU0OTllYjdkNjM0YzNlNGIxMDdlNTVmZDAzNjE3MgpzaXplIDI2NjAyMQo="},4974:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6MmJkZjAyMWI5NDRiNmYyYzU4YjA0YjAwNzcxYWZhYzQ5ZGI1ZWRlNzhjZDljZjFmZTcyYjk3MDhjOGI0NDQ0ZQpzaXplIDE3NzM2MAo="},24362:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6NjUyYmNkNGRkMTlkODVhYmM1NGZlZDUyYjNkOWFkOGRlMGQ3MzgxYWI3MjY5OGJhYWM2YWI5NjFkM2U1NWY2OApzaXplIDE4NDUyMwo="},72628:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6YzY1Nzg3NmZiYzg1YjJhY2Y4MjEzOTEwZDQ2MjAyNzk2Yjg2MWI1MWFlMzRhMTM5M2RmZTk4ZmFmZGZiYzFlYQpzaXplIDIyOTI4Mwo="},29126:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,dmVyc2lvbiBodHRwczovL2dpdC1sZnMuZ2l0aHViLmNvbS9zcGVjL3YxCm9pZCBzaGEyNTY6YWQzNDAwMGE3Yzg4N2E1Y2I2YzBkOTFjNTgzMGUzN2M3YmRlZmIwM2E0ZGVhNTc3ZWYzY2VmMjhhYWQzM2YwNApzaXplIDI3MzE2NAo="}}]);