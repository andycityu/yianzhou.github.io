"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4369],{75659:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var n=i(87462),o=(i(67294),i(3905));i(61839);const a={},r="User Notification",l={unversionedId:"Frameworks/user-notification",id:"Frameworks/user-notification",title:"User Notification",description:"WWDC 2020 - The Push Notifications primer",source:"@site/docs/apple/Frameworks/user-notification.md",sourceDirName:"Frameworks",slug:"/Frameworks/user-notification",permalink:"/docs/apple/Frameworks/user-notification",draft:!1,editUrl:"https://github.com/yianzhou/yianzhou.github.io/docs/apple/Frameworks/user-notification.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Unified Logging",permalink:"/docs/apple/Frameworks/unified-logging"},next:{title:"Apple Bugs",permalink:"/docs/apple/apple-bugs"}},p={},c=[{value:"Request Authorization",id:"request-authorization",level:2},{value:"Notification Payload",id:"notification-payload",level:2},{value:"Alert Notification",id:"alert-notification",level:2},{value:"Background Notification",id:"background-notification",level:2},{value:"UNNotificationTrigger",id:"unnotificationtrigger",level:2}],s={toc:c};function u(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,n.Z)({},s,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"user-notification"},"User Notification"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/videos/play/wwdc2020/10095/"},"WWDC 2020 - The Push Notifications primer")),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/usernotifications/implementing_alert_push_notifications"},"Sample Code - Implementing Alert Push Notifications")),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/usernotifications/implementing_background_push_notifications"},"Sample Code - Implementing Background Push Notifications"))),(0,o.kt)("p",null,"There are two types of push notifications: alert notifications and background notifications."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Alert notifications")," allow you to deliver visible alerts that can be interacted."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Background notifications")," allow your application to fetch data from the background upon receiving push notifications. These should be used to keep your application up-to-date even if the application isn't running. The system will launch your application and give you necessary runtime in order to perform your background update.")),(0,o.kt)("h2",{id:"request-authorization"},"Request Authorization"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-swift"},"/// \u662f\u5426\u8be2\u95ee\u8fc7\u901a\u77e5\u6743\u9650\nvar notDetermined = false\n// iOS 10 \u53ca\u4ee5\u4e0a\nUNUserNotificationCenter.current().getNotificationSettings { (settings) in\n    if settings.authorizationStatus == .notDetermined {\n        notDetermined = true\n    }\n}\nUNUserNotificationCenter.current().requestAuthorization(options: [.alert, .badge, .sound]) { (granted, error) in\n    if notDetermined && granted {\n        // \u9996\u6b21\u8be2\u95ee\u5e76\u540c\u610f\u4e86\n    } else if notDetermined && !granted {\n        // \u9996\u6b21\u8be2\u95ee\u5e76\u62d2\u7edd\u4e86\n    } else if !notDetermined && granted {\n        // \u7528\u6237\u4e4b\u524d\u5df2\u540c\u610f\u8fc7\u4e86\n    } else {\n        // \u7528\u6237\u4e4b\u524d\u5df2\u62d2\u7edd\u8fc7\u4e86\n    }\n}\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"registerUserNotificationSettings(_:)")," \u5df2\u5e9f\u5f03\u3002"),(0,o.kt)("h2",{id:"notification-payload"},"Notification Payload"),(0,o.kt)("p",null,"This is an example payload for an alert notification:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "Simulator Target Bundle": "com.yianzhou.demo",\n  "aps": {\n    "alert": {\n      "title": "\u6d4b\u8bd5\u6807\u9898",\n      "subtitle": "\u6d4b\u8bd5\u526f\u6807\u9898",\n      "body": "\u6d4b\u8bd5\u5185\u5bb9"\n    },\n    "sound": "default",\n    "badge": 1\n  },\n  // \u9644\u52a0\u4fe1\u606f\uff0c\u901a\u8fc7 `response.notification.request.content.userInfo` \u53d6\u5230\n  "payloads": {\n    "url": "demo://playerv2?id=769"\n  }\n}\n')),(0,o.kt)("p",null,"\u521b\u5efa json \u6587\u4ef6\u3001\u6dfb\u52a0\u4e0a\u9762\u7684\u5185\u5bb9\uff0c\u901a\u8fc7\u547d\u4ee4\u884c\u53ef\u4ee5\u63a8\u9001\u5230\u6a21\u62df\u5668\uff1a",(0,o.kt)("inlineCode",{parentName:"p"},"xcrun simctl push booted ./1605665134.json")),(0,o.kt)("p",null,"An example of background notification payload:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "aps": {\n    "content-available": 1\n  },\n  "myCustomKey": "myCustomData"\n}\n')),(0,o.kt)("p",null,"The only field required for background notifications is the ",(0,o.kt)("inlineCode",{parentName:"p"},"content-available")," field inside of the aps dictionary. This field tells the system that this is a background notification and that your application should be launched to perform your updates."),(0,o.kt)("h2",{id:"alert-notification"},"Alert Notification"),(0,o.kt)("p",null,"\u8c03\u8bd5\u5de5\u5177\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KnuffApp/Knuff"},"Knuff"),"\u3001",(0,o.kt)("a",{parentName:"p",href:"https://github.com/shaojiankui/SmartPush"},"SmartPush")),(0,o.kt)("p",null,"1","."," \u6210\u4e3a\u4ee3\u7406"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},"@interface AppDelegate () <UNUserNotificationCenterDelegate>\n@end\n\nUNUserNotificationCenter *center = [UNUserNotificationCenter currentNotificationCenter];\ncenter.delegate = self;\n")),(0,o.kt)("p",null,"2","."," App \u542f\u52a8\u65f6\uff0c\u5411 APNS \u8bf7\u6c42 deviceToken\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    [[UIApplication sharedApplication] registerForRemoteNotifications];\n}\n\n- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken {\n    NSLog(@"%@", deviceToken);\n    [self forwardTokenToServer:deviceToken];\n}\n\n- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error {\n    NSLog(@"error, %@", error);\n}\n')),(0,o.kt)("p",null,"3","."," \u6536\u5230\u901a\u77e5\u3001\u70b9\u51fb\u901a\u77e5\u3001\u51b7\u542f\u52a8 App\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'#import <UserNotifications/UserNotifications.h>\n- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {\n    [UNUserNotificationCenter currentNotificationCenter].delegate = self;\n    NSDictionary *remoteNotification = [launchOptions valueForKey:UIApplicationLaunchOptionsRemoteNotificationKey];\n    if (remoteNotification) {\n        NSDictionary *params = launchOptions[@"..."];\n        // \u6682\u5b58\u53c2\u6570\uff0c\u7a0d\u540e\u4f7f\u7528\n        NSLog(@"%@", params);\n    }\n}\n')),(0,o.kt)("p",null,"4","."," App \u5728\u540e\u53f0\u3001\u6536\u5230\u901a\u77e5\u3001\u70b9\u51fb\u901a\u77e5\u3001\u70ed\u542f\u52a8 App\uff1b\u6216\u8005 App \u5728\u524d\u53f0\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"willPresentNotification")," \u8c03\u7528\u7cfb\u7edf\u65b9\u6cd5\u5728\u524d\u53f0\u5c55\u793a\u4e86\u6d88\u606f\uff0c\u70b9\u51fb\u4e5f\u4f1a\u6267\u884c\u4ee5\u4e0b\u8fd9\u4e2a\u65b9\u6cd5\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},'- (void)userNotificationCenter:(UNUserNotificationCenter *)center didReceiveNotificationResponse:(UNNotificationResponse *)response withCompletionHandler:(void (^)(void))completionHandler {\n    UNNotification *noti = ((UNNotificationResponse *)response).notification;\n    NSDictionary *userInfo = noti.request.content.userInfo;\n    NSDictionary *params = userInfo[@"..."];\n    NSLog(@"%@", params);\n    completionHandler(); // must be called\n}\n')),(0,o.kt)("p",null,"5","."," App \u5728\u524d\u53f0\u65f6\u6536\u5230\u901a\u77e5\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},"- (void)userNotificationCenter:(UNUserNotificationCenter *)center willPresentNotification:(UNNotification *)notification withCompletionHandler:(void (^)(UNNotificationPresentationOptions))completionHandler {\n    completionHandler(UNNotificationPresentationOptionBadge|UNNotificationPresentationOptionAlert);\n}\n")),(0,o.kt)("p",null,"\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5728 iOS 10+ deprecated \u5e76\u88ab\u4e0a\u8ff0\u65b9\u6cd5\u66ff\u4ee3\u3002"),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"del"},"- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo;"))),(0,o.kt)("p",null,(0,o.kt)("del",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"del"},"- (void)application:(UIApplication *)application didReceiveLocalNotification:(UILocalNotification *)notification;"))),(0,o.kt)("h2",{id:"background-notification"},"Background Notification"),(0,o.kt)("p",null,"\u9759\u9ed8\u63a8\u9001\u4e0d\u4f1a\u663e\u793a\u4efb\u4f55\u63a8\u9001\u6d88\u606f\u3002\u7cfb\u7edf\u4f1a\u5c06\u5728\u540e\u53f0\u9759\u9ed8\u542f\u52a8 app\u3001\u6216\u8005\u4ece\u6302\u8d77\u72b6\u6001\u5524\u9192\u5b83\u3002\u5f00\u53d1\u8005\u6709 30s \u7684\u65f6\u95f4\u5185\u5728\u8be5\u56de\u8c03\u65b9\u6cd5\u4e2d\u5904\u7406\u4e00\u4e9b\u4e1a\u52a1\u903b\u8f91\uff0c\u5e76\u5728\u5904\u7406\u5b8c\u6210\u540e\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"fetchCompletionHandler"),"\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-objc"},"- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler {\n    // completionHandler(.failed);\n    // completionHandler(.noData);\n    completionHandler(.newData); // This allows the system to be smart about when to launch your application in the future.\n}\n")),(0,o.kt)("p",null,"The system calls this method when your app is running in the foreground or background. In addition, if you enabled the remote notifications background mode, the system launches your app (or wakes it from the suspended state) and puts it in the background state when a remote notification arrives. However, the system does not automatically launch your app if the user has force-quit it. In that situation, the user must relaunch your app or restart the device before the system attempts to launch your app automatically again."),(0,o.kt)("h2",{id:"unnotificationtrigger"},"UNNotificationTrigger"),(0,o.kt)("p",null,"UNNotificationTrigger is an abstract class, concrete trigger classes include the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UNTimeIntervalNotificationTrigger")," \u65f6\u95f4\u95f4\u9694\u89e6\u53d1\uff08\u672c\u5730\uff09"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UNCalendarNotificationTrigger")," \u65e5\u671f\u89e6\u53d1\uff08\u672c\u5730\uff09"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UNLocationNotificationTrigger")," \u5730\u70b9\u89e6\u53d1\uff08\u672c\u5730\uff09"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UNPushNotificationTrigger")," \u670d\u52a1\u7aef\u63a8\u9001\uff08\u8fdc\u7a0b\uff09")))}u.isMDXComponent=!0}}]);